
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 4-core network, expiring 16 Dec 2025
Serial number: 501809302042
  Licensed to: WBG User
               World Bank

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running C:\Program Files\Stata18\sysprofile.do ...

. do batch_2025.do 

. *!v2.0
. *============================================================================
> ===
. * Macro-Micro Simulations
. *============================================================================
> ===
. * Created on : July 24, 2024
. * Last update: October 1, 2024
. *============================================================================
> ===
. * Prepared by: South Asia Regional Stats Team
. 
. * Initiated by: Sergio Olivieri
. * E-mail: colivieri@worldbank.org
. 
. * Modified by: Kelly Montoya, Jaime Fernandez Romero and Israel Osorio Rodart
> e
. * For this version e-mail: iosoriorordarte@worldbank.org
. *============================================================================
> ===
. 
. *============================================================================
> ===
. * TIME
. *============================================================================
> ===
. set processors 4
    The maximum number of processors or cores being used is 4.  It can be set
    to any number between 1 and 4.

. set type double

. frame reset

. program drop _all

. clear mata

. capture which etime

. if _rc ssc install etime

. etime, start

. *============================================================================
> ===
. 
. *============================================================================
> ===
. * RUNNING STEPS
. *============================================================================
> ===
. {
. * Step 1: Load base household survey data for simulation
.         local  step1_loadhhdata  ""             // if yes, save simulation da
> ta
.                 global reload_dlw        ""             // SUBOPTION: if yes,
>  reloads simulation databases from datalibweb
. 
. * Step 2: Calculate macro-micro inputs, (aka elasticity tool)
.         local step2_macromicroinputs "" // recalculates the macro and micro i
> nputs needed for simulation
. 
. * Step 3: Run macro-micro simulation
.         local  step3_runsim       "yes"         // Run simulations      
.                 
.         * Initial and final year for sequential run
.                 local iniyear = 2022 // Initial year when doing sequential ru
> ns
.                 local finyear = 2026 // Final year when doing sequential runs
. 
.         * *local parallel
.                 *local parallel         "yes"   // If "yes", the program will
>  run simulation parallel mode
. 
.         * Parallel run set up
.                 * If *local parallel is set to "yes". Then n batch files will
>  be created
.                 * with the name batch_`i'.do located in the working directory
> .
.                 * Select initial and final parallel years below 
.                         local iniparallelyear = 2022    // First batch file t
> o be created
.                         local finparallelyear = 2026    // Last batch file to
>  be created
.                         *local parallel_automatic "yes"  // If yes, parallel 
> run will start automatically
.                                                                              
>            // Otherwise, call the batch file from terminal or the command pro
> mpt
. }               

. *============================================================================
> ===
. * PATHS - Modify according to your local route
. *============================================================================
> ===
. {
. * Main
.         * MacOSX and Unix
.         if (c(os)=="MacOSX"|c(os)=="Unix") & c(username)=="Israel" {
.                  gl main  "/Users/Israel/OneDrive/WBG/ETIRI/Projects/FY25/FY2
> 5 - SAR MPO AM24"
.         }
.         * Windows
.         if c(os)=="Windows" & c(username)=="WB308767" {
.                  gl main  "C:/Users/WB308767/OneDrive/WBG/ETIRI/Projects/FY25
> /FY25 - SAR MPO AM24"
.         }
.         
. * Path  
.         gl path "$main/BGD-MPO-Microsimulation/2024AM"
.         cd "$path"
C:\Users\WB308767\OneDrive\WBG\ETIRI\Projects\FY25\FY25 - SAR MPO AM24\BGD-MPO-
> Microsimulation\2024AM
.         
. * Do-files path
.         global dofiles     "$path/Do-files" // Do-files path
. 
. * Data directories
.         cap mkdir "${path}/Data"
.         gl data_root "${path}/Data"
.         gl data_in   "${path}/Data/INPUT"
.         gl data_out  "${path}/Data/OUTPUT"
. 
. }

. 
. *============================================================================
> ===
. * Country Parameters
. *============================================================================
> ===
. {
. * Globals for country and year identification
.         global country BGD                      // Country to upload
.         global year 2022                        // household survey year to u
> se
.         global final_year 2026          // Last simulated year
.         global base_year 2022           // Base year for building LAVs
. 
. * Parameters
.         *gl use_saved_parameters "yes" // Not working yet
.         gl re_scale ""                  // Change for "yes"/"no" re-scale usi
> ng total income
.         gl sector_model 3               // 
.         gl random_remittances "no" // Change for "yes" or "no" on modelling
.         gl baseyear 2022
. 
. }

. *============================================================================
> ===
. * Parallelization - Don't modify
. *============================================================================
> ===
. {
.         * Parallel operationalization, do not modify
.         
.                 scalar xrxx = 1                 // Do not modify
.                 scalar xrxy = 1                 // Do not modify
.                 local iniyear=2025      // Do not modify
.                 local finyear=2025      // Do not modify
. 
.                 * Create batch files in MacOSX with sed function
.                 if "`parallel'"=="yes" & (c(os)=="MacOSX"|c(os)=="Unix") {
.                         cd "$dofiles"
.                         
.                         * Create myscript.sh
.                         cap erase myscript.sh
.                         cap file close myscript
.                         file open myscript using myscript.sh, write
.                         
.                         * Create n batch_`bi'.do files
.                         forval bi = `iniparallelyear'/`finparallelyear' {
  2.                                 
.                                 * Copy batch file
.                                 !cp "0 master.do" "batch_`bi'.do"
  3.                                 * Replace xrxx and xryy with initial and f
> inal years
.                                 !sed -i '' "s/iniyear=2025/iniyear=`bi'/g" ba
> tch_`bi'.do
  4.                                 !sed -i '' "s/finyear=2025/finyear=`bi'/g"
>  batch_`bi'.do
  5.                                 * Turn off parallel option
.                                 !sed -i '' "s/local[[:space:]]parallel/**loca
> l parallel/g" batch_`bi'.do
  6.                                 
.                                 * Append line to myscript.sh
.                                 file write myscript "/usr/local/bin/stata-mp 
> -b do batch_`bi' &" _n
  7.                         }
.                         
.                         * Close myscript.sh file
.                         file close myscript
.                         !chmod u+rx myscript.sh
.                         if "`parallel_automatic'"=="yes" {
.                                 !./myscript.sh
.                         }
.                         etime
.                         exit
.                 }
.                 
.                 * Create batch files in Windows with powershell
.                 if "`parallel'"=="yes" & c(os)=="Windows" {
.                         cd "$dofiles"
.                         
.                         * Create myscript.sh
.                         cap erase myscript.bat
.                         cap file close myscript
.                         file open myscript using myscript.bat, write
.                         
.                         * Create n batch_`bi'.do files
.                         forval bi = `iniparallelyear'/`finparallelyear' {
  2.                                                                 
.                                 * Copy batch file
.                                 !copy "0 master.do" "batch_`bi'.do"
  3.                                 * Replace _fake xrxx and xryy with initial
>  and final years
.                                 *!powershell -command " (Get-Content batch_`b
> i'.do) -replace 'iniyear=2025', 'iniyear=`bi'' | Out-File -encoding ASCII bat
> ch_`bi'.do "
.                                 *!powershell -command " (Get-Content batch_`b
> i'.do) -replace 'finyear=2025', 'finyear=`bi'' | Out-File -encoding ASCII bat
> ch_`bi'.do "
.                                 * Turn off parallel option
.                                 *!powershell -command " (Get-Content batch_`b
> i'.do) -replace '*local parallel', '**local parallel' | Out-File -encoding AS
> CII batch_`bi'.do "
.                                 
.                                 !powershell -command " (Get-Content batch_`bi
> '.do) -replace 'iniyear=2025', 'iniyear=`bi'' | Out-File -encoding ASCII batc
> h_`bi'.do ; (Get-Content batch_`bi'.do) -replace 'finyear=2025', 'finyear=`bi
> '' | Out-File -encoding ASCII batch_`bi'.do ; (Get-Content batch_`bi'.do) -re
> place '*local parallel', '**local parallel' | Out-File -encoding ASCII batch_
> `bi'.do"
  4.                                 
.                                 * Append line to myscript.sh
.                                 if `bi'==`iniparallelyear' file write myscrip
> t `"   "`c(sysdir_stata)'/StataMP-64" /e /i do batch_`bi'.do "'
  5.                                 else                       file write mysc
> ript `" | "`c(sysdir_stata)'/StataMP-64" /e /i do batch_`bi'.do "'
  6.                         }
.                         
.                         * Close myscript.sh file
.                         file close myscript     
.                         if "`parallel_automatic'"=="yes" { 
.                                 !myscript.bat
.                         }
.                         etime
.                         exit    
.                 }
. }

. 
. *============================================================================
> ===
. * Step 1: Load and save household survey for simulation
. * The process must be done before starting the macro-micro simulation.
. * Here, we force it to be run only during sequential runs.
. * Running it in parallel mode can create problems when the same file is being
>  
. * saved by each parallel instance.
. * This happens more often in Windows environments.
. *============================================================================
> ===
. if "`step1_loadhhdata'"=="yes" & "`parallel'"=="" {
.         
.         * The harmonized HIES contains 160 variables and 76.8MB
.         * The minimum harmonized HIES contains 74 variables and 12.5MB
.         
.         * 000. Load data
.         do "$dofiles/001_load_data.do"
.         save "$data_root/BGD_2022_HIES_v02_M_v02_A_SARMD_SIM.dta", replace
.         
.         
.         * Minimum set of variables for simulation
.         *#delimit ;
.         *local minvarset  "industry3 industry3_2
.         *                                 occup_year occup_2_year            
>             
.         
.         * 010. Prepare variables for regressions
.         do "$dofiles/010_variables.do"
. 
.         #delimit ;
delimiter now ;
.         local minvarset "year countrycode subnatid1 urban
>                                         hhid pid wgt hsize h_size
>                                         age male edad relationharm id married
>  h_head
>                                         atschool educ_lev 
>                                         active emplyd unemplyd self_emp unpai
> d salaried salaried2 self_emp2 unpaid2
>                                         labor_rel labor_rel2 public_job
>                                         sect_main sect_secu  
>                                         occupation
>                                         skill_edu  skill_occup  skill
>                                         sample sample_1 sample_2
>                                         h_inc 
>                                         h_lai 
>                                         h_remesas
>                                         h_pensions
>                                         h_capital
>                                         h_renta_imp
>                                         h_otherinla
>                                         h_transfers
>                                         h_nlai
>                                         remitt_any
>                                         depen
>                                         oth_pub
>                                         ln_lai_m
>                                         lai_m
>                                         tot_lai
>                                         lai_s
>                                         food_share nfood_share
>                                         ipcf_ppp17
>                                         pline_int pline_nat welfarenat welfar
> enom_ppp17 cpi2017 icp2017";
.         #delimit cr
delimiter now cr
.         keep `minvarset'        
. 
.         compress
.         
.                 global use_saved_parameters "no"
.                 * 030.model labor incomes by groups
.                         do "$dofiles/030_occupation.do"
.                 * 040.model labor incomes by skills
.                         do "$dofiles/040_labor_income.do"
.         
.         
.         save "$data_root/BGD_2022_HIES_v02_M_v02_A_SARMD_SIM_MIN.dta", replac
> e
. 
. }

. 
. *============================================================================
> ===
. * Step 2: Calculates simulation parameters from macro and micro databases
. * The process must be done before simulation steps.
. * Here, we force it to be run only during sequential runs.
. *============================================================================
> ===
. if "`step2_macromicroinputs'"=="yes" & "`parallel'"=="" {
. 
.         * 002 Update United Nations World Population Prospects
.                 * output A: "$data_in/UN WPP/popdata_sar_mpo.dta"
.         do "$dofiles/002_import_pop_wpp_wdi.do"
.         
.         * 003. Process standard-MFMod parameters for Tableau
.                 * output B: "$data_in/POV_MOD/macrodata.dta"
.                 * output C: "$data_in/Tableau/AM24/MPO Check data.dta"
.                 * output D: "$data_in/Macro and elasticities/mfmod_bgd.dta"  
>    
.         do "$dofiles/003_sar_mpo_tableau_dashboard.do"
.                 
.         * 004 (master) Elaticity tool based on HIES and LFS
.                 * 005, 006, and 007 are called within 004
.                 * output E: "$data_in/Macro and elasticities/input_elasticiti
> es_hies.dta"
.                 * output F: "$data_in/Macro and elasticities/input_elasticiti
> es_lfs.dta"
.                 * output G: "$data_in/Macro and elasticities/Elasticities.dta
> "
.         do "$dofiles/004_masterelasticity.do"
.         
.                 
.         * Append all databases
.         * Output A
.         use "$data_in/UN WPP/popdata_sar_mpo.dta", clear
.                 isid country year indicator
.                 decode title, gen(strtitle)
.                 drop title
.                 rename strtitle title
.                 keep    country year indicator value title date
.                 order   country year indicator value title date
.         tempfile a
.         save `a', replace
. 
.         * Output B
.         use "$data_in/POV_MOD/macrodata.dta", clear
.                 *decode title, gen(strtitle)
.                 drop title
.                 rename strtitle title
.                 keep    country year indicator value title date
.                 order   country year indicator value title date
.         tempfile b
.         save `b', replace
. 
.         * Output C
.         use "$data_in/Tableau/AM_24 MPO Check/MPO Check data.dta", clear
.                 replace indicator = lower(indicator)
.                 replace indicator = "ma" + indicator
.                 keep    country year indicator value title date
.                 order   country year indicator value title date
.         tempfile c
.         save `c', replace
.         
.         * Output D
.         use "$data_in/Macro and elasticities/mfmod_bgd.dta", clear
.         append using "$data_in/Macro and elasticities/mfmod_bgd_base.dta"    
>    // For July 2024 baseline
.         drop ind
.         tempfile d
.         save `d', replace
.                 
.         
.         use `a', clear
.         append using `b'
.         append using `c'
.         append using `d'
.         
.         save               "$path/input-mpo.dta", replace
.         export excel using "$path/input_MASTER.xlsx", sheet("input-mpo", repl
> ace) firstrow(variables)
.         
.         * INFLOWS
.         use if indicator=="mfbxfstremtcd" using "$data_in/Macro and elasticit
> ies/mfmod_bgd.dta", clear
.         order country year value
.         export excel using "$path/input_MASTER.xlsx", sheet("inflows", replac
> e) firstrow(variables)
.         
.         * OUTPUT E
.         use "$data_in/Tableau/AM_24 MPO Check/input-labor-hies.dta", clear
.                 gen date = "`c(current_date)'"
.                 keep    country year indicator value title date nsectors
.                 order   country year indicator value title date nsectors
.                 tempfile e
.                 save `e', replace
.         
.         * OUTPUT F
.         use "$data_in/Tableau/AM_24 MPO Check/input-labor-lfs.dta", clear
.                 gen date = "`c(current_date)'"          
.                 keep    country year indicator value title date nsectors
.                 order   country year indicator value title date nsectors
.                 tempfile f
.                 save `f', replace
.         
.         use `e', clear
.         append using `f'
.         
.         save               "$path/input-labor", replace
.         export excel using "$path/input_MASTER.xlsx", sheet("input-labor", re
> place) firstrow(variables)
.         
.         * OUTPUT G
.         use "$data_in/Macro and elasticities/Elasticities.dta", clear
.         save                       "$path/input-elasticities.dta", replace
.         export excel using "$path/input_MASTER.xlsx", sheet("Elasticities") s
> heetreplace firstrow(variables)
. }

. *===========================================================================
. * run dofiles
. *===========================================================================
. if "`step3_runsim'"=="yes" {
. 
. 
.         forval yyyy = `iniyear'/`finyear' {
  2.                 clear all
  3.                 clear mata
  4.                 clear matrix
  5. 
.                 * Declarre simulation year
.                 global sim_year = `yyyy'
  6.                 
.                 if "`yyyy'"=="`iniyear'" global use_saved_parameters "yes"
  7.                 else                                     global use_saved_
> parameters "yes"
  8. 
.                 * Use base household survey
.                 if ${year}==2022 use "$data_root/BGD_2022_HIES_v02_M_v02_A_SA
> RMD_SIM_MIN.dta", clear
  9.                 
.                 * Globals for reading scenarios
.                 *gl inputs   "$path/Microsimulation_Inputs_BGD_A3_BaUAM2024.x
> lsm" // Country's input Excel file
.                 gl inputs   "$path/Microsimulation_Inputs_BGD_A3_CrisisAM2024
> .xlsm"
 10.                 
.                 * Load auxiliary simulation programs
.                 local files : dir "$dofiles/auxcode" files "*.*do"
 11.                 di `files'
 12.                 foreach f of local files{
 13.                         dis in yellow "`f'"
 14.                         mata: mata set matastrict off
 15.                         qui: run "$dofiles/auxcode/`f'"
 16.                 }
 17.                 
.                 * 020.input parameters
.                         do "$dofiles/020_parameters.do"
 18.                 * 030.model labor incomes by groups
.                         *do "$dofiles/030_occupation.do"
.                 * 040.model labor incomes by skills
.                         do "$dofiles/040_labor_income.do"
 19.                 * 050.modeling population growth
.                         do "$dofiles/050_population.do"
 20.                 * 060.modeling labor activity rate
.                         do "$dofiles/060_activity.do"
 21.                 * 070.modeling unemployment rate
.                         do "$dofiles/070_unemployment.do"
 22.                 * 080.modeling changes in employment by sectors
.                         do "$dofiles/080_struct_emp.do"
 23.                 * 090.modeling labor income by sector
.                         do "$dofiles/090_asign_labor_income.do" 
 24.                 * 100.income growth by sector
.                         if "$re_scale" == "yes" do "$dofiles/100_income_rel_n
> ew.do"
 25.                         if "$re_scale" == ""    do "$dofiles/101_income_re
> l_new_no_rescaling.do"
 26.                 * 110. total labor incomes
.                         do "$dofiles/110_total_income.do"
 27.                 * 120. total non-labor incomes
.                         if "$random_remittances" == "no"  do "$dofiles/120_as
> sign_nlai.do"
 28.                         if "$random_remittances" == "yes" do "$dofiles/121
> _assign_nlai.do"
 29.                 * 130. household income
.                         do "$dofiles/130_household_income.do"
 30.                 * 140. household consumption
.                         do "$dofiles/140_household_consumption.do"
 31.                         
.                 * Quick summary
.                         ineqdec0 welfare_ppp17  [w=wgt]
 32.                         ineqdeco pc_con_s               [w=fexp_s]
 33.                         apoverty welfare_ppp17  [w=wgt], line(2.15)
 34.                         apoverty pc_con_s pc_con_preadj [w=fexp_s], line(2
> .15)
 35.                         
.                 drop if welfarenom==.
 36.                 save "${data_out}/basesim_`yyyy'", replace
 37.         }
cuantiles.dodesigual.dofgt.dogini.domatnames.domtab1.domyfrappend.adoparam_res.
> doprog_mata.doshares.dosimchoiceres.dotheil.dozk.do
cuantiles.do
desigual.do
fgt.do
gini.do
matnames.do
mtab1.do
myfrappend.ado
param_res.do
prog_mata.do
shares.do
simchoiceres.do
theil.do
zk.do

. *!v1.0
. *===========================================================================
. * TITLE: Set up parameters
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *===========================================================================
. * Created on : Dec 03, 2020
. * Last update: Jun 26, 2024 - Israel Osorio Rodarte
. *                          Jan 04, 2021 Kelly Y. Montoya
. *                          Jan 13, 2021 - Modification of average labor incom
> e sheet
. *                          Jul 22, 2022 - Added macro data matrix for re-scal
> ing with sectoral and total GDP in the new model
. *                          Jul 25, 2022 - Added WDI population matrix for new
>  weights
. *                          Jul 26, 2022 - Moved model set up from master. Mut
> ed population by gender.
. *===========================================================================
. 
. *===========================================================================
. * setting up the model
. *===========================================================================
. 
. 
. * mata matrix
. mata:
------------------------------------------------- mata (type end to exit) -----
: void st_shares(string scalar name1)
> {
>         real matrix M,N,P
>         M = st_matrix(name1)
>     N = runningsum(M[1..(rows(M)-1),1])
>     P = N:/M[rows(M),1]
>     st_matrix("shr",P)
> }

: end
-------------------------------------------------------------------------------

. 
. 
. *===========================================================================
. * general parameters
. *===========================================================================
. 
. preserve

. 
. import excel using "$inputs", sheet("input_setup") first clear
(6 vars, 1 obs)

. 
. * type of estimation
. gl national   = type_estimation[1]

. if $national == 1 gl tipo "local"

. if $national == 0 gl tipo "inter"  

. 
. * select scenario
. *gl model = model[1]
. *tostring model, replace
. 
. * bonus
. if inlist(bonus,1) gl bonus = 1

. if inlist(bonus,0) gl bonus = 0 

. 
. * sectors (by default 6 sectors)
. gl m = num_sectors[1]

. 
. * new weights
. if inlist(weights,1) gl weights = 1

. if inlist(weights,0) gl weights = 0

. 
. * Read LAV sheet from Excel Input File
. import excel using "$inputs", sheet("linkage_aggregate_variables") first clea
> r    // previously called resumen
(31 vars, 43 obs)

.         keep parameters value* lav*

.         drop if parameters==""
(10 observations deleted)

.         reshape long value lav, i(parameters) j(year)
(j = 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023 2024 2025 2026)
(variable lav2014 not found)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations               33   ->   429         
Number of variables                  26   ->   4           
j variable (13 values)                    ->   year
xij variables:
      value2014 value2015 ... value2026   ->   value
            lav2014 lav2015 ... lav2026   ->   lav
-----------------------------------------------------------------------------

.         keep if year==$sim_year
(396 observations deleted)

.         rename lav rate

.         tempfile lavdata

. save `lavdata', replace
(file C:\Users\WB308767\AppData\Local\Temp\ST_62e0_000002.tmp not found)
file C:\Users\WB308767\AppData\Local\Temp\ST_62e0_000002.tmp saved as .dta
    format

. 
. * macro data (See sheet "input_gpd")
. use `lavdata', clear

.         keep if substr(parameters,1,3)=="gdp"
(29 observations deleted)

.         sort parameters

. mkmat rate, mat(growth_macro_data)

. 
. * average labor incomes (See sheet "input_labor_incomes")
. use `lavdata', clear

.         keep if substr(parameters,1,3)=="inc"
(26 observations deleted)

.         gen A = substr(parameters,length(parameters)-1,2)

.         replace A = "z0" if A=="A0"     // To place it at the bottom
(1 real change made)

.         sort A parameters

. mkmat rate, mat(growth_labor_income)

. 
. * labor market (See sheet "input_labor")
. use `lavdata', clear

.         keep if substr(parameters,1,2)=="sh"|parameters=="parti_rate"|paramet
> ers=="unemp_rate"
(25 observations deleted)

.         gen A = "A0"

.         replace A = substr(parameters,length(parameters)-1,2) if substr(param
> eters,1,2)=="sh"
(6 real changes made)

.         sort A parameters

. mkmat rate, mat(growth_labor)

. 
. * non-labor incomes (See sheet "input_nonlabor")
. use `lavdata', clear

.         gen order = . 
(33 missing values generated)

.         replace order = 1 if parameter=="remittances"
(1 real change made)

.         replace order = 2 if parameter=="pensions"
(1 real change made)

.         replace order = 3 if parameter=="capital"
(1 real change made)

.         replace order = 4 if parameter=="bdh"
(1 real change made)

.         replace order = 5 if parameter=="jgl"
(1 real change made)

.         keep if order!=.
(28 observations deleted)

.         sort order

. mkmat rate, mat(growth_nlabor)

. 
. * total population (See sheet "input_pop_wdi")
. use `lavdata', clear

.         keep if parameter=="total population"
(32 observations deleted)

. mkmat value, mat(growth_pop_wdi)

. *Alternatively, for using the growth rate:
. *mkmat rate, mat(growth_pop_wdi)
. 
. * GDP Per Capita
. use `lavdata', clear

.         keep if parameter=="pccons"
(32 observations deleted)

. mkmat rate, mat(pccons)

. 
. restore

. 
. *===========================================================================
. *                                     END
. *===========================================================================
. 
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 04 - Modeling labor incomes by education skills and economic sector
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Mar 17, 2020
. * Last update: Jan 08, 2021
. *                          Apr 19, 2022 - Included estimations saving (Kelly 
> Y. Montoya)
. *                          Jul 25, 2022 - Change loc numsector (only 3 sector
> s). KYM
. *============================================================================
> =
. 
. *============================================================================
> =
. 
. * y vars 
. loc depvar "ln_lai_m"

. 
. * x vars 
. loc ols_rhs           c.age##c.age urban ib0.male##ib0.h_head

. loc ols_rhs `ols_rhs' ib0.male#ibn.educ_lev salaried public_job

. loc ols_rhs `ols_rhs' ib1.region

. 
. levelsof sect_main , loc(numb_sectors)
1 2 3 4 5 6

. levelsof skill, loc(numb_skills)
1 2

. 
. foreach sector of numlist `numb_sectors' {
  2. 
.         foreach skill of numlist `numb_skills' {
  3.         
.                 * Parameters
.                 if "$use_saved_parameters" == "no" {
  4.                         regress `depvar' `ols_rhs' [pw = wgt] if sect_main
>  == `sector' & skill == `skill'   & sample == 1
  5.                         estimates save "${data_root}/models/${country}_${y
> ear}/Income_sector_`sector'_skill_`skill'.dta", replace
  6.                 }
  7.                 else {
  8.                         estimates use "${data_root}/models/${country}_${ye
> ar}/Income_sector_`sector'_skill_`skill'.dta"
  9.                         *estimates esample: `depvar' `ols_rhs' [pw = wgt] 
> if  sect_main  == `sector' & skill == `skill'   & sample==1
.                 }
 10.         
.                 mat b_`sector'_`skill' = e(b)
 11.                 scalar sigma_`sector'_`skill' = e(rmse)  
 12.         }
 13. }

. 
. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
end of do-file

. *!v1.0
. *===========================================================================
. * TITLE: 05 - Population Growth
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *===========================================================================
. * Created on : Mar 17, 2020
. * Last update: Jan 05, 2021
. *===========================================================================
. * Modified by: Kelly Y. Montoya
. *                               Jul 25, 2022 - Adjusted fexp_s according to W
> DI population.
. *===========================================================================
. loc prior_wgt "wgt"

. loc nw_name   "all"

. 
. *===========================================================================
. * household ID (numeric) = psu + household   
. *sort psu id, stable
. *egen psuhid = group(psu id)
. 
. 
. 
. if $weights == 1 {
. *===========================================================================
. * 1. dummies for category
. *===========================================================================
. * dummies by cross categories "gender and age groups"
. gen     age_groups =  .
. replace age_groups =  1 if age >=  0 & age <=  14
. replace age_groups =  2 if age >= 15 & age <=  29
. replace age_groups =  3 if age >= 30 & age <=  44
. replace age_groups =  4 if age >= 45 & age <=  64
. replace age_groups =  5 if age >= 65 
. 
. egen int groupvar = group(male age_groups) 
. xi i.groupvar, noomit prefix(_by)
. unab caliblist: _by*
. 
. 
. loc mem_rel   "h_head"
. loc byvars    "male age_groups"
. loc hhd_id    "hhid"
. loc prior_wgt "wgt"
. loc nw_name   "all"
. 
. *===========================================================================
. * 2. means by category and total population in base year
. *===========================================================================
. total `caliblist' [pw = `prior_wgt'] 
. mat  tot_old = e(b)
. 
. * share by groups
. sum `prior_wgt' if e(sample), meanonly 
. scalar  total_`nw_name' = r(sum)
. mat mean_old = tot_old / r(sum)
. mat mean_old = mean_old'
. 
. * add n-1 restrictions
. mata: st_matrix("tot_new", st_matrix("tot_old"):*st_matrix("vec_pop_grw1")')
. mata: st_matrix("mean_`nw_name'",st_matrix("tot_new")'/sum(st_matrix("tot_new
> ")))
. mata: st_local("totalnew",strofreal(sum(st_matrix("tot_new")),"%20.5f"))
. mata: st_numscalar("TN1",sum(st_matrix("tot_new")))
. mat mean_`nw_name'c = mean_`nw_name'[2...,1]
. 
. *===========================================================================
. * 3. constrains
. *===========================================================================
. capture drop sort
. gsort `hhd_id' -`mem_rel'
. gen long sort = _n 
. bysort `hhd_id' (sort): gen byte _first = (_n == 1) 
. 
. 
. capture drop aux
. gen aux = 1 
. egen _hhsize = sum(aux), by(`hhd_id')
. 
. 
. * I use this expression in case individuals have different weights in the hou
> sehold
. * Within the household
. bysort `hhd_id' (sort): gen double _sumw_`nw_name' = sum(`prior_wgt')    
. bysort `hhd_id' (sort): replace    _sumw_`nw_name' = _sumw_`nw_name'[_N] 
. 
. foreach x of varlist `caliblist' {
  2.     bysort `hhd_id' (sort): gen double m_`nw_name'_`x' = sum(`x' * `prior_
> wgt' ) 
  3.     bysort `hhd_id' (sort): replace    m_`nw_name'_`x' = m_all_`x'[_N]/_su
> mw_`nw_name'
  4.         loc recaliblist `recaliblist' m_`nw_name'_`x'
  5. }
. 
. * add n-1 restrictions
. loc first: word 1 of `recaliblist'
. loc recaliblist: list recaliblist - first
. mat rownames mean_`nw_name'c = `recaliblist'
. 
. loc nw_name = "all"
. loc mem_rel  "h_head"
. tempvar factor_`nw_name'
. loc varlist: rownames(mean_`nw_name'c)
. mata: st_local("totalnew",strofreal(sum(st_matrix("tot_new")),"%20.5f"))
. 
. noi di "maxentropy `varlist' if `mem_rel' == 1, matrix(mean_`nw_name'c) prior
> (`prior_wgt') generate(`factor_`nw_name'') total(`totalnew')"
. maxentropy `varlist' if `mem_rel' == 1, matrix(mean_`nw_name'c) prior(`prior_
> wgt') generate(`factor_`nw_name'') total(`totalnew')
. 
. bysort `hhd_id' (sort): gen `nw_name'_wgt = `prior_wgt' * `factor_`nw_name''[
> 1]/_sumw_`nw_name'
. la var `nw_name'_wgt "Simulated `nw_name' weights"
. 
. drop aux* psuhid groupvar age_groups
. 
. //gen fexp_s = fexp
. //label var fexp_s "weight -$scenario"
. 
. rename  all_wgt fexp_s 
. 
. 
. }

. 
. 
. if $weights == 0 {
.     
.         sum wgt [w = wgt]
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         wgt |  61,849   165687181    4160.661   1958.489   411.2634   8718.561
.         sca var0 = r(sum_w)
.         sca var1 = growth_pop_wdi[1,1]
.         sca ratio_pop = var1/var0
.         gen fexp_s = round(`prior_wgt'* ratio_pop)
.         
.         * Check
.         sum fexp_s [w = fexp_s]
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
      fexp_s |  61,849   170747266    4287.796   2018.395        424       8985
.         if abs(r(sum_w) - growth_pop_wdi[1,1]) > 1000000 di in red "WARNING: 
> Population differs in more than a million people with WDI."
.         
.         
.         * Another way to adjust but keeping all decimal positions.
.         /*sum fexp_s [w = fexp_s]
>         if abs(r(sum_w) - growth_pop_wdi[1,1]) != 0 {
>             sum fexp_s [w = fexp_s]
>                 sca var0 = r(sum_w) - growth_pop_wdi[1,1]
>                 sca var1 = growth_pop_wdi[1,1]
>                 sca ratio_pop = var0/var1
>                 replace fexp_s = fexp_s * (1 + ratio_pop)
>         }*/
. 
. }

. 
. *===========================================================================
. *                                     END
. *===========================================================================
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 06 - Simulating changes in the labor force participation rate
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *                          Aug 09, 2022 Kelly Y. Montoya minor corrections an
> d warnings.
. *============================================================================
> =
. 
. *============================================================================
> =
. 
. * sample labor force 
. gen lf_samp = (active ==1) if sample==1
(17,415 missing values generated)

. sum lf_samp [aw = wgt] 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lf_samp |  44,434   119100762    .4654076   .4988075          0          1

. 
. * goal
. note: this procedure changes the labor market structure (% inactivity, unempl
> oyment, employment by sector) according to elasticities.

. mat activity = J(1,1,r(mean))

. mat activity = r(mean)*(1 + growth_labor[1,1])

. mat list activity

symmetric activity[1,1]
           c1
r1  .43658033

. 
. * allocate individuals according to their utility of being inactive
. *clonevar  active_s = lf_samp
. clonevar  active_s = active

. clonevar U0 = U0_1 
(52,623 missing values generated)

. replace  U0 = U0_2 if U0 == .
(12,613 real changes made)

. gsort -active_s U0 hhid 

. cap drop aux*

. 
. qui sum fexp_s                               if sample == 1 & lf_samp != . 

. gen double aux = sum(fexp_s)/r(sum)  if sample == 1 & lf_samp != . 
(17,415 missing values generated)

. replace active_s = 1    if aux <= (activity[1,1] + 10^(-23)) & sample == 1 & 
> lf_samp !=. 
(0 real changes made)

. replace active_s = 0    if aux >  (activity[1,1] + 10^(-23)) & sample == 1 & 
> lf_samp !=. 
(1,759 real changes made)

. 
. * check
. sum lf_samp  [aw = wgt]   if sample == 1 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lf_samp |  44,434   119100762    .4654076   .4988075          0          1

. scalar v0 = r(mean)

. sum active_s [aw = fexp_s] if sample == 1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    active_s |  44,434   122738108    .4365772   .4959668          0          1

. scalar v1 = r(mean)

. 
. di scalar(v1)/scalar(v0)-1
-.06194656

. mat list growth_labor

growth_labor[8,1]
          rate
r1  -.06193984
r2   .08615098
r3   .00112596
r4   .00149385
r5  -.09327309
r6  -.00432255
r7    .0323513
r8   .05050473

. 
. if abs( round((scalar(v1)/scalar(v0)-1),.005) - round(growth_labor[1,1],.005)
>  ) != 0 {
.         di in red "WARNING: New active population doesn´t match growth rate."
.         break
. }

. 
. cap drop aux*

. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 07 - Simulating changes in the unemployment rate
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *                          Aug 09, 2022 Kelly Y. Montoya minor corrections an
> d warnings.
. *============================================================================
> =
. 
. *============================================================================
> =
. 
. * sample unemployment rate 
. gen     aux = unemplyd / lf_samp 
(41,465 missing values generated)

. sum aux [w = wgt] if lf_samp == 1
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  20,384  55430400.1    .0440891    .205298          0          1

. * goal
. mat unemploy = r(mean)*(1 + growth_labor[2,1])

. mat list unemploy

symmetric unemploy[1,1]
           c1
r1  .04788737

. 
. * allocate individuals according to their probability of being unemployed
. *gen    unemplyd_s = unemplyd  if active_s == 1
. clonevar unemplyd_s = unemplyd

. clonevar U10 = U10_1 
(52,623 missing values generated)

. replace  U10 = U10_2 if U10 == .
(12,613 real changes made)

. gsort -unemplyd_s U10 id 

. cap drop aux*

. 
. qui sum fexp_s                              if active_s == 1 

. gen double aux = sum(fexp_s)/r(sum) if active_s == 1 
(42,935 missing values generated)

. 
. replace unemplyd_s = 1                      if aux <= (unemploy[1,1] + epsflo
> at()) & active_s == 1 
(47 real changes made)

. replace unemplyd_s = 0                      if aux >  (unemploy[1,1] + epsflo
> at()) & active_s == 1 
(0 real changes made)

. 
. * simulating: employment status
. *gen     emplyd_s = emplyd  if active_s  == 1
. clonevar emplyd_s = emplyd

. replace emplyd_s = 1       if unemplyd_s == 0 & active_s == 1
(7 real changes made)

. replace emplyd_s = 0       if unemplyd_s == 1 & active_s == 1
(47 real changes made)

. tab emplyd_s active_s

           |       active_s
  emplyd_s |         0          1 |     Total
-----------+----------------------+----------
         0 |    39,314        949 |    40,263 
         1 |     3,621     17,965 |    21,586 
-----------+----------------------+----------
     Total |    42,935     18,914 |    61,849 

. 
. * check 
. capt drop aux

. gen     aux = unemplyd / lf_samp 
(41,465 missing values generated)

. sum aux [w = wgt] if lf_samp == 1 
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  20,384  55430400.1    .0440891    .205298          0          1

. scalar v0 = r(mean)

. 
. cap drop aux

. gen     aux = unemplyd_s / active_s 
(42,935 missing values generated)

. sum aux [w = fexp_s] if active_s == 1 
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  18,914    54389129    .0478842   .2135269          0          1

. scalar v1 = r(mean)

. 
. di scalar(v1)/scalar(v0)-1
.08607946

. mat list growth_labor

growth_labor[8,1]
          rate
r1  -.06193984
r2   .08615098
r3   .00112596
r4   .00149385
r5  -.09327309
r6  -.00432255
r7    .0323513
r8   .05050473

. 
. if abs( round((scalar(v1)/scalar(v0)-1),.005) - round(growth_labor[2,1],.005)
>  ) != 0 {
.         di in red "WARNING: New active population doesn´t match growth rate."
.         break
. }

. 
. drop aux*

. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
end of do-file

. *!v1.0
. *===========================================================================
. * TITLE: 08 - Simulating changes in the employment structure
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *===========================================================================
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *                          Aug 10, 2022 Kelly Y. Montoya Changed estructure s
> ectoral matrix line 293.
. *                          Aug 11, 2022 Kelly Y. Montoya Changed informality 
> simulation and added checks for estructure and informality.
. *===========================================================================
. 
. note: those with public jobs do not change between sectors

. 
. *===========================================================================
. * I. MISCELLANEOUS TASKS  
. *===========================================================================
. 
. * public sector fixed
. clonevar public   = public_job
(40,223 missing values generated)

. 
. * number of sectors
. clonevar sectorg = sect_main
(40,522 missing values generated)

. 
. sum sectorg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     sectorg |     21,327    3.846861     1.59241          1          6

. loc lim = r(max)

. 
. * employment structure 
. mat sector     = J(`lim',1,.)

. mat sect_prv   = J(`lim',1,.)

. mat sect_pub   = J(`lim',1,.)

. 
. mat sector_s   = J(`lim',1,.)

. mat sect_prv_s = J(`lim',1,.)

. mat sect_pub_s = J(`lim',1,.)

. 
. forvalues a = 1/`lim' {
  2.         
.         * base year 
.         sum wgt if sample == 1 & emplyd == 1 & sectorg == `a' 
  3.         mat sector[`a',1]   = r(sum)
  4. 
.         sum wgt if sample == 1 & emplyd == 1 & sectorg == `a' & public == 0 
  5.         mat sect_prv[`a',1]   = r(sum)
  6.         
.         sum wgt if sample == 1 & emplyd == 1 & sectorg == `a' & public == 1
  7.         mat sect_pub[`a',1]   = r(sum)
  8.         
.         * simulated
.         sum fexp_s if sample == 1 & emplyd_s == 1 & sectorg == `a' 
  9.         mat sector_s[`a',1] = r(sum)
 10. 
.         sum fexp_s if sample == 1 & emplyd_s == 1 & sectorg == `a' & public =
> = 0 
 11.         mat sect_prv_s[`a',1] = r(sum)
 12. 
.         sum fexp_s if sample == 1 & emplyd_s == 1 & sectorg == `a' & public =
> = 1 
 13.         mat sect_pub_s[`a',1] = r(sum)
 14. }

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |        939    3082.417    1801.169   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |        934    3090.396    1800.212   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |          5    1591.936    1437.944   411.2634   3612.648

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        934    3175.104     1855.34        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        929    3183.363     1854.35        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |          5      1640.6    1481.908        424       3723

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,232    2978.101    1640.055   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,212    2985.474    1638.455   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |         20    1056.769    607.6478   475.7301   2718.986

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,213     3067.46    1690.817        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,193     3075.08    1689.172        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |         20        1089    626.1895        490       2802

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      3,582    2868.485    2191.247   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      3,519    2876.612    2193.157   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |         63      2414.5    2047.147   411.2634   8057.709

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      3,580    2957.258    2258.333        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      3,517     2965.66      2260.3        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |         63    2488.222    2109.699        424       8304

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      1,987    2978.173    2193.334   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      1,908    3010.822    2204.033   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |         79    2189.634    1751.084   411.2634   6185.226

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      1,980    3072.184    2260.707        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      1,901    3106.084    2271.739        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |         79    2256.443    1804.537        424       6374

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,577     2541.52    2035.911   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,185    2581.944     2048.04   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |        392    2006.832    1786.195   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,570    2619.113    2098.883        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,178    2660.825    2111.453        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        392    2068.133    1840.767        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      4,010    2318.446    2036.428   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      3,218    2441.775    2071.936   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |        792    1817.345    1801.581   411.2634   8057.709

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      4,003    2389.453    2099.109        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      3,212    2516.507    2135.624        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        791     1873.53    1857.733        424       8304

. 
. * employment matrix goals 
. loc row_tot = rowsof(growth_labor)

. local lim =6

. mat growth_estru = growth_labor[3..`row_tot',1]

. 
. mata: st_mat("growth_estru", "sector", 1,`lim')

. mat sector = sector , sector_mata

. mata: st_gr("sector_s", "shares_mata")

. 
. * re-weighting the shares 
. sum fexp_s if emplyd_s == 1 & sample == 1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |     21,280     2809.19    2059.334        424       8985

. ret li

scalars:
                  r(N) =  21280
              r(sum_w) =  21280
               r(mean) =  2809.19022556391
                r(Var) =  4240855.384368012
                 r(sd) =  2059.33372340862
                r(min) =  424
                r(max) =  8985
                r(sum) =  59779568

. mata: st_repond_1("shares_mata", "growth_estru", 2, `r(sum)', "sector_rep")

. 
. * sector dummies: identifying employed individuals who already have sector an
> d those who do not
. forvalues s = 1/`lim' {
  2.         gen d_act`s'     = cond(sectorg == `s',1,0) if sample == 1 & emply
> d_s == 1
  3.         gen d_act`s'_sim = d_act`s'                  
  4. }
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)
(40,569 missing values generated)

. 
. order d_act*_sim

. 
. * This is only for those who belongs to the employment in both moments
. egen    changed = rsum(d_act1_sim - d_act`lim'_sim) if emplyd_s == 1 & emplyd
>  == 1 & sample  == 1
(40,569 missing values generated)

. tab     changed

    changed |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     21,280      100.00      100.00
------------+-----------------------------------
      Total |     21,280      100.00

. 
. 
. *===========================================================================
. *II. SECTORS WHICH REDUCED THEIR EMPLOYMENT LEVELS
. *===========================================================================
. * Mata rutine which orders sectors in ascending way 
. mata: st_order("growth_estru_n", 1, 2, "aux")

. 
. dis in red "SECTORS WHICH REDUCED THEIR EMPLOYMENT LEVELS"
SECTORS WHICH REDUCED THEIR EMPLOYMENT LEVELS

. 
. forvalues r = 1/`lim' {
  2.         
.         *drop jobs from decreasing sectors 
.         if aux[`r',2] < 0 {
  3. 
.                 *identifies the sector          
.                 loc s = aux[`r',1] 
  4.                 dis in red "economic sector `s'"
  5.                 
.                 *orders the population according to: activity, probability, h
> hd id and ind id 
.                 loc p = `s' + 10
  6.                 noi di "Sector `s' Occupation `p'"
  7.                 clonevar P`s' = U`p'_1 
  8.                 replace  P`s' = U`p'_2 if P`s' == .
  9.                 
.                 gsort  -d_act`s'_sim -P`s' id -public
 10.                 capture drop aux
 11.                 gen     aux = sum(fexp_s) if emplyd_s == 1 & emplyd == 1 &
>  d_act`s'_sim == 1                                                 
 12.                 replace d_act`s'_sim = 0  if emplyd_s == 1 & emplyd == 1 &
>  d_act`s'_sim == 1 & (aux > sector_rep[`s',1] ) 
 13.                 
.                 drop aux changed
 14.                 egen    changed = rsum(d_act1_sim - d_act`lim'_sim) if emp
> lyd_s == 1 & emplyd == 1 & sample  == 1 
 15.         }
 16. }
economic sector 3
Sector 3 Occupation 13
(52,623 missing values generated)
(12,613 real changes made)
(58,269 missing values generated)
(468 real changes made)
(40,569 missing values generated)
economic sector 4
Sector 4 Occupation 14
(52,623 missing values generated)
(12,613 real changes made)
(59,869 missing values generated)
(17 real changes made)
(40,569 missing values generated)

. 
. *===========================================================================
. *II. SECTORS WHICH INCREASE THEIR EMPLOYMENT LEVELS
. *===========================================================================
. * Mata routine which orders sectors in descending way
. mata: st_order("growth_estru_n", 1, -2, "aux")

. 
. * Employed ranking(t): 1- employed(t-1) and changed sector; 2- unemployed(t-1
> ); 3- inactives(t-1)
. gen     rank$t =.
(61,849 missing values generated)

. replace rank$t = 1 if emplyd_s == 1 & emplyd  == 1 & changed == 0
(485 real changes made)

. replace rank$t = 2 if emplyd_s == 1 & unemplyd == 1 
(0 real changes made)

. replace rank$t = 3 if emplyd_s == 1 & lf_samp  == 0
(1,927 real changes made)

. 
. dis in red "SECTORS WHICH INCREASED THEIR EMPLOYMENT LEVELS"
SECTORS WHICH INCREASED THEIR EMPLOYMENT LEVELS

. 
. forvalues r = 1/`lim'   {
  2. 
.         * Asign a job to increasing sectors
.         if aux[`r',2]>=0        {
  3.         
.                 * Identifies the sector         
.                 loc s = aux[`r',1] 
  4.                 dis in red "economic sector `s'"
  5. 
.                 loc p = `s' + 10
  6.                 noi di "Sector `s' Occupation `p'"
  7.                 clonevar P`s' = U`p'_1 
  8.                 replace  P`s' = U`p'_2 if P`s' == .
  9.                 
.                 gsort -d_act`s'_sim rank$t -P`s' id 
 10. 
.                 gen aux = sum(fexp_s)       if (d_act`s'_sim == 1 | rank$t !=
>  .)                                                           
 11.                 replace d_act`s'_sim = 1        if  d_act`s'_sim == 0 & ra
> nk$t != .  & (aux <= sector_rep[`s',1]) 
 12. 
.                 drop changed aux
 13.                 egen    changed = rsum(d_act1_sim - d_act`lim'_sim) if emp
> lyd_s == 1 & sample  == 1
 14.                 sum     changed
 15.                                 
.                 replace rank$t = . if changed == 1 & emplyd_s == 1 & emplyd  
> == 1
 16.                 replace rank$t = . if changed == 1 & emplyd_s == 1 & unemp
> lyd == 1
 17.                 replace rank$t = . if changed == 1 & emplyd_s == 1 & lf_sa
> mp  == 0 
 18.         }
 19. }
economic sector 6
Sector 6 Occupation 16
(52,623 missing values generated)
(12,613 real changes made)
(55,886 missing values generated)
(206 real changes made)
(40,569 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,280    .9868891    .1137524          0          1
(2,130 real changes made, 2,130 to missing)
(0 real changes made)
(0 real changes made)
economic sector 5
Sector 5 Occupation 15
(52,623 missing values generated)
(12,613 real changes made)
(56,000 missing values generated)
(211 real changes made)
(40,569 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,280    .9968045    .0564396          0          1
(211 real changes made, 211 to missing)
(0 real changes made)
(0 real changes made)
economic sector 1
Sector 1 Occupation 11
(52,623 missing values generated)
(12,613 real changes made)
(60,847 missing values generated)
(15 real changes made)
(40,569 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,280    .9975094    .0498449          0          1
(15 real changes made, 15 to missing)
(0 real changes made)
(0 real changes made)
economic sector 2
Sector 2 Occupation 12
(52,623 missing values generated)
(12,613 real changes made)
(56,583 missing values generated)
(51 real changes made)
(40,569 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,280     .999906    .0096944          0          1
(51 real changes made, 51 to missing)
(0 real changes made)
(0 real changes made)

. 
. 
. *===========================================================================
. *III. Allocate sectors for those who were not assigned (by growth rate and sh
> are employment)
. *===========================================================================
. *mata: st_repond("sector","growth_estru" , 2, 1, "sector_shr", "share")
. sum rank$t

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        rank |          2           3           0          3          3

. loc mm = r(N)

. dis in red "`mm'"
2

. 
. while (`mm' > 0) {
  2.         forvalues r = 1/`lim'   {
  3.         
.                 loc s = aux[`r',1] 
  4. 
.                 if growth_estru[`s',1]>0        {
  5.         
.                         loc p = shares_mata[`s',2]
  6.                 
.                         di in red "this is p: " "`p'"
  7.                 
.                         gsort -d_act`s'_sim -P`s' id 
  8.                         sum fexp_s                                   if em
> plyd_s == 1 & changed == 0 
  9.                         gen aux = sum(fexp_s)/r(sum) if emplyd_s == 1 & ch
> anged == 0 
 10.                         replace d_act`s'_sim = 1         if emplyd_s == 1 
> & changed == 0 & rank$t !=. & (aux <= `p') 
 11.                 
.                         drop changed aux
 12.                         egen changed = rsum(d_act1_sim - d_act`lim'_sim) i
> f emplyd_s ==1
 13.                         sum  changed
 14. 
.                         replace rank$t =. if changed == 1 & emplyd_s == 1 & e
> mplyd == 1
 15.                         replace rank$t =. if changed == 1 & emplyd_s == 1 
> & unemplyd ==1
 16.                         replace rank$t =. if changed == 1 & emplyd_s == 1 
> & lf_samp == 0
 17.                 }
 18.                 
.                 if growth_estru[`s',1]<0        {
 19.         
.                         loc p = shares_mata[`s',2]
 20.                 
.                         di in red "this is p: " "`p'"
 21.                 
.                         gsort -d_act`s'_sim -P`s' id 
 22.                         sum fexp_s                                      if
>  emplyd_s == 1 & changed == 0 
 23.                         gen aux = sum(fexp_s)/r(sum)    if emplyd_s == 1 &
>  changed == 0 
 24.                         replace d_act`s'_sim = 1                if emplyd_
> s == 1 & changed == 0 & rank$t !=. & (aux <= `p') 
 25.                 
.                         drop changed aux
 26.                         egen changed = rsum(d_act1_sim - d_act`lim'_sim)  
>       if emplyd_s ==1
 27.                         sum  changed
 28. 
.                         replace rank$t =. if changed == 1 & emplyd_s == 1 & e
> mplyd == 1
 29.                         replace rank$t =. if changed == 1 & emplyd_s == 1 
> & unemplyd ==1
 30.                         replace rank$t =. if changed == 1 & emplyd_s == 1 
> & lf_samp == 0
 31.                 }
 32.         }
 33.         
.         sum rank$t
 34.         loc mm = r(N)
 35.         di in red "there are `mm' observations left"
 36.         if `mm' < 102 loc mm = 0        
 37.         note: adjust in case it doesn´t converge, increase the 16. 
 38. }
this is p: .1679844159705043

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |          2        1673    1422.699        667       2679
(61,847 missing values generated)
(0 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9857315    .1185984          0          1
(0 real changes made)
(0 real changes made)
(0 real changes made)
this is p: .2516814713870877

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        308    2837.659    2076.797        424       8304
(61,541 missing values generated)
(2 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9858241    .1182182          0          1
(2 real changes made, 2 to missing)
(0 real changes made)
(0 real changes made)
this is p: .049839681952197

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        306    2845.271    2079.851        424       8304
(61,543 missing values generated)
(0 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9858241    .1182182          0          1
(0 real changes made)
(0 real changes made)
(0 real changes made)
this is p: .2684015682213342

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        306    2845.271    2079.851        424       8304
(61,543 missing values generated)
(0 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9858241    .1182182          0          1
(0 real changes made)
(0 real changes made)
(0 real changes made)
this is p: .1013435412288228

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        306    2845.271    2079.851        424       8304
(61,543 missing values generated)
(0 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9858241    .1182182          0          1
(0 real changes made)
(0 real changes made)
(0 real changes made)
this is p: .1602448984729723

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        306    2845.271    2079.851        424       8304
(61,543 missing values generated)
(0 real changes made)
(40,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     changed |     21,586    .9858241    .1182182          0          1
(0 real changes made)
(0 real changes made)
(0 real changes made)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        rank |          0
there are 0 observations left

. 
. drop changed rank$t

. 
. *===========================================================================
. * Creates new activity
. *===========================================================================
. gen act$t = .
(61,849 missing values generated)

. forvalues s = 1/`lim'   {
  2.         replace act$t = `s' if d_act`s'_sim == 1 &  act$t == .
  3.         }
(949 real changes made)
(5,264 real changes made)
(3,112 real changes made)
(1,963 real changes made)
(5,783 real changes made)
(4,209 real changes made)

. drop d_act*

. 
. 
. * new main labor sector 
.         gen           sect_main_s = .
(61,849 missing values generated)

.         replace   sect_main_s =  1 if act$t == 1
(949 real changes made)

.         replace   sect_main_s =  2 if act$t == 2 
(5,264 real changes made)

.         replace   sect_main_s =  3 if act$t == 3
(3,112 real changes made)

.         replace   sect_main_s =  4 if act$t == 4
(1,963 real changes made)

.         replace   sect_main_s =  5 if act$t == 5
(5,783 real changes made)

.         replace   sect_main_s =  6 if act$t == 6
(4,209 real changes made)

.         replace   sect_main_s = sectorg if sect_main_s== . & sample == . & em
> plyd_s == 1
(0 real changes made)

.         label var sect_main_s "economic sector simulated"

.         
.         *recode sect_main6_s (1 2 = 1) (3 4 = 2) (5 6 = 3), gen(sect_main_s)
.         *label values sect_main_s sector
.         *ADD labels!
.         
.         
. * new occupation status
.         gen     occupation_s = .
(61,849 missing values generated)

.         replace occupation_s = 0  if  active_s    == 0 & sample == 1
(25,809 real changes made)

.         replace occupation_s = 10 if  unemplyd_s  == 1 & sample == 1
(1,031 real changes made)

.         replace occupation_s = 11 if  sect_main_s == 1 & sample == 1
(949 real changes made)

.         replace occupation_s = 12 if  sect_main_s == 2 & sample == 1
(5,264 real changes made)

.         replace occupation_s = 13 if  sect_main_s == 3 & sample == 1
(3,112 real changes made)

.         replace occupation_s = 14 if  sect_main_s == 4 & sample == 1
(1,963 real changes made)

.         replace occupation_s = 15 if  sect_main_s == 5 & sample == 1
(5,783 real changes made)

.         replace occupation_s = 16 if  sect_main_s == 6 & sample == 1
(4,209 real changes made)

. 
.         label var    occupation_s "occupation status - simulated"

.         label values occupation_s occupation

. 
. 
. 
. *===========================================================================
. * Creates the structure sectoral matrix
. *===========================================================================
. mat sector   = J(`lim',1,.)

. mat sector_s = J(`lim',1,.)

. 
. forvalues a = 1/`lim' {
  2.         sum wgt if sample == 1 & emplyd == 1 & sectorg == `a'
  3.         mat sector[`a',1]   = r(sum)
  4.  
.         if $m == 1 {
  5.                 sum fexp_s if sample == 1 & emplyd_s == 1 & sect_main_s== 
> `a'
  6.                 mat sector_s[`a',1] = r(sum)
  7.         }
  8.         
.         if $m != 1 {
  9.                 sum fexp_s if sample == 1 & emplyd_s == 1 & sect_main_s== 
> `a'
 10.                 mat sector_s[`a',1] = r(sum)
 11.         }
 12. }

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |        939    3082.417    1801.169   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |        949    3140.939    1862.425        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,232    2978.101    1640.055   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,264    3049.456    1697.471        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      3,582    2868.485    2191.247   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      3,112    3079.178    2309.787        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      1,987    2978.173    2193.334   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      1,963    3087.615    2263.387        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      5,577     2541.52    2035.911   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      5,783    2603.537    2081.908        424       8985

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         wgt |      4,010    2318.446    2036.428   411.2634   8718.561

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      fexp_s |      4,209    2386.989    2085.163        424       8985

. 
. mat growth_estru = growth_labor[3..`row_tot',1]

. mata: st_mat("growth_estru", "sector", 1,`lim')

. mat sector = sector , sector_mata

. 
. mat list sector

sector[6,2]
           c1         c1
r1  2894389.5  2897648.4
r2   15581426   15604702
r3   10274913  9316539.8
r4  5917630.4  5892051.1
r5   14174057   14632606
r6  9296969.6  9766510.6

. mat list sector_s 

sector_s[6,1]
          c1
r1   2980751
r2  16052337
r3   9582403
r4   6060988
r5  15056252
r6  10046837

. 
. * including those out of sample
. replace unemplyd_s   = unemplyd if sample == .
(0 real changes made)

. replace emplyd_s     = emplyd   if sample == .
(7 real changes made)

. replace active_s     = lf_samp  if sample == .
(17,415 real changes made, 17,415 to missing)

. replace sect_main_s = sectorg  if sect_main_s== . & sample == . & emplyd_s ==
>  1
(0 real changes made)

. 
. * check new sectoral structure 
. clonevar sectorg_s = sect_main_s 
(40,569 missing values generated)

. local lim = 6

. forvalues a = 1/`lim' {
  2.         
.         capt drop aux
  3.         gen aux = sectorg == `a' if sample == 1 & sectorg != .
  4.         sum aux [w = wgt] if lf_samp == 1
  5.         scalar v0 = r(mean)
  6.                 
.         capt drop aux
  7.         gen aux = sectorg_s == `a' if sample == 1 & sectorg_s != .
  8.         sum aux [w = fexp_s] if active_s == 1
  9.         scalar v1 = r(mean)
 10.         
.         if abs( round((scalar(v1)/scalar(v0)-1),.005) - round(growth_estru[`a
> ',1],.005) ) > 0.01 {
 11.                 di in red "WARNING: New sectoral estructure doesn´t match 
> growth rates."
 12.                 break
 13.         }       
 14. }
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526    .0543885   .2267886          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .0529026   .2238453          0          1
WARNING: New sectoral estructure doesn´t match growth rates.
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526     .291298   .4543722          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .2750536   .4465538          0          1
WARNING: New sectoral estructure doesn´t match growth rates.
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526    .1932398   .3948496          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .1864807    .389505          0          1
WARNING: New sectoral estructure doesn´t match growth rates.
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526    .1112598   .3144617          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .1159716   .3201998          0          1
WARNING: New sectoral estructure doesn´t match growth rates.
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526    .1953846   .3965067          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .2039678   .4029567          0          1
WARNING: New sectoral estructure doesn´t match growth rates.
(40,522 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  19,400    52986526    .1544292    .361369          0          1
(40,569 missing values generated)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
         aux |  17,766    51219923    .1656238   .3717531          0          1
WARNING: New sectoral estructure doesn´t match growth rates.

. 
. drop aux*

. 
. /*
> 
> *===========================================================================
> * Informality rates by economic sector
> *===========================================================================
> 
> * Creating a new informal variable
> cap drop informal_s
> 
> if $m == 1 {
>         
>         gen      informal_s = informal if emplyd_s == 1
> 
>         * random numbers
>         capture drop aleat_inf
>         set seed 12345678
>         gen aleat_inf = uniform() if sample == 1 
> 
>         * in and out of informality
>         sum sect_main
>         loc lim = r(max)
> 
>         * Creates the structure sectoral matrix - targets
>         mat informal      = J(`lim',1,.)
> 
>         forvalues a = 1/`lim' {
>                 sum informal [w = wgt] if lf_samp == 1 & emplyd == 1 & sect_m
> ain == `a' 
>                 mat informal[`a',1] = r(mean)*(1 + growth_informal[`a',1])
>         }
> 
>         * Allocate individuals according to their probability of being employ
> ed
>         gsort  sect_main_s -informal_s aleat_inf id 
> 
>         forvalues i = 1/`lim' {
>       
>                 qui sum fexp_s if active_s == 1 & sect_main_s == `i'
>                 gen double aux = sum(fexp_s)/r(sum) if emplyd_s == 1 & sect_m
> ain_s == `i'
>                 replace informal_s = 1 if aux <= (informal[`i',1] + epsfloat(
> )) & emplyd_s == 1 & sect_main_s == `i'
>                 replace informal_s = 0 if aux >  (informal[`i',1] + epsfloat(
> )) & emplyd_s == 1 & sect_main_s == `i'
>                 drop aux*
> 
>         }
> }
> 
> if $m != 1 {
>         
>         gen     informal_s = 1 if (sect_main6_s == 2 | sect_main6_s== 4 | sec
> t_main6_s== 6) & emplyd_s == 1
>         
>         replace informal_s = 0 if (sect_main6_s == 1 | sect_main6_s== 3 | sec
> t_main6_s== 5) & emplyd_s == 1
> }
> 
> 
> * Check new informal rates
> sum sect_main
> loc lim_inf = r(max)
> forvalues a = 1/`lim_inf' {
>                 
>         capt drop aux
>         gen aux = informal / lf_samp if sample == 1
>         sum aux [w = wgt] if lf_samp == 1 & sect_main == `a'
>         scalar v0 = r(mean)
>                 
>         capt drop aux
>         gen aux = informal_s / active_s if sample == 1
>         sum aux [w = fexp_s] if active_s == 1 & sect_main_s == `a' 
>         scalar v1 = r(mean)
>         
>         if abs( round((scalar(v1)/scalar(v0)-1),.005) - round(growth_informal
> [`a',1],.005) ) > 0.01 {
>                 di in red "WARNING: New informal workers in sector `a' doesn´
> t match growth rate."
>         }
>                 
> 
> }
> 
> * Bringing back those who do not belong to the sample
> replace informal_s = informal if sample == . & informal_s == .
> 
> *===========================================================================
> *                                     END
> *===========================================================================
> 
> */
. 
end of do-file

. *!v1.0
. *===========================================================================
. * TITLE: 090 - Assign labor income by sector
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *===========================================================================
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *===========================================================================
. 
. *===========================================================================
. * Random numbers
. *===========================================================================
. capture drop aleat_ila

. set seed 23081985

. gen aleat_ila = uniform() if sample == 1 
(17,415 missing values generated)

. 
. ** I- Asign the contrafactual labor income by sector
. 
. *  IMPUTATION of salaried to those who come from the non-employed status in o
> rder to obtain the INCOME LINEAR PROJECTION
. sum sectorg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     sectorg |     21,327    3.846861     1.59241          1          6

. loc lim = r(max)

. replace salaried = . if unemplyd == 1
(0 real changes made)

. 
. forvalues i = 1/`lim' {
  2.    forvalues k =1(1)2 {
  3.            
.    sum salaried  [w = wgt] if sectorg == `i' & sample_`k' == 1
  4.    sca ns_`k'_`i' = 1-r(mean)
  5.    
.    sum public_job    [w = wgt] if sectorg == `i' & sample_`k' == 1
  6.    sca pj_`k'_`i' = 1-r(mean)
  7.         
.    }
  8. }

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |     603  1871176.34    .2250343   .4179516          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |     603  1871176.34    .0004584   .0214232          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |     332  1015463.55    .0617389    .241044          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |     332  1015463.55    .0065224   .0806194          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   3,371  10116455.6    .4005575   .4900841          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   3,371  10116455.6    .0004662   .0215907          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   1,853  5441274.07    .2048962   .4037347          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   1,853  5441274.07    .0030174   .0548631          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   1,883   5153949.8    .8761613   .3294849          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   1,883   5153949.8    .0029659   .0543935          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   1,690  5103698.47    .8488877   .3582643          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   1,690  5103698.47    .0267163   .1613007          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |     747  2146730.17     .840324   .3665507          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |     747  2146730.17    .0065642   .0808077          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   1,236  3764231.55    .8041026   .3970506          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   1,236  3764231.55    .0415661   .1996763          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   2,935  7667588.57    .5017294   .5000822          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   2,935  7667588.57    .0117453   .1077557          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   2,623  6465677.25    .5025092    .500089          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   2,623  6465677.25    .1073788   .3096532          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |     614  1559160.63    .3506176   .4775524          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |     614  1559160.63    .0220563   .1469865          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    salaried |   3,351  7623861.95    .5591647   .4965613          0          1

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  public_job |   3,351  7623861.95    .1816153   .3855847          0          1

. 
. *===========================================================================
. * SALARIED - NON-SALARIED
. *===========================================================================
. 
. * Identifies the people who change sector by education level
. gen     ch_l = (occupation != occupation_s) if sample_1 == 1 & (occupation_s 
> > 0 & occupation_s < .) & salaried == .
(61,644 missing values generated)

. replace ch_l = . if ch_l == 0
(205 real changes made, 205 to missing)

. gen     ch_h = (occupation != occupation_s) if sample_2 == 1 & (occupation_s 
> > 0 & occupation_s < .) & salaried == .
(61,071 missing values generated)

. replace ch_h = . if ch_h == 0
(778 real changes made, 778 to missing)

. 
. * Assigns the same salaried structure of the sector
. capture drop aux_l* aux_h* 

. * Creates the new salaried variable
. clonevar salaried_s = salaried
(40,223 missing values generated)

. replace  salaried_s = 1 if (ch_l == 1 | ch_h == 1) 
(0 real changes made)

. 
. forvalues i = 1/`lim' {
  2.         sum  ch_l [aw = fexp_s] if sect_main_s== `i'
  3.         if r(sum) != 0 {
  4.                 gen  aux_l_`i' = sum(fexp_s)/r(sum) if ch_l == 1 & sect_ma
> in_s== `i'
  5.                 sort aleat_ila, stable
  6.                 replace salaried_s = 0 if  aux_l_`i' <= ns_1_`i'
  7.                 di in ye "share of self employment is ===>   ns_1_`i'  = "
>  scalar(ns_1_`i')
  8.                 ta salaried_s [aw=fexp_s] if aux_l_`i' != .
  9.         }
 10. 
.         sum  ch_h [aw = fexp_s] if occupation_s == `i'
 11.         if r(sum) != 0 {
 12.                 gen  aux_h_`i' = sum(fexp_s)/r(sum) if ch_h == 1 & sect_ma
> in_s== `i'
 13.                 sort aleat_ila, stable
 14.                 replace salaried_s = 0 if  aux_h_`i' <= ns_2_`i'
 15.                 di in ye "share of self employment is ===>   ns_2_`i'  = "
>  scalar(ns_2_`i')
 16.                 ta salaried_s [aw=fexp_s] if aux_h_`i' != .
 17.         }
 18. }

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

. 
. 
. rename ch_l ch_l_sal

. rename ch_h ch_h_sal

. capture drop aux_l_*

. capture drop aux_h_*

. 
. *===========================================================================
. * PUBLIC - PRIVATE JOBS
. *===========================================================================
. 
. * a) Identifies the people who change sector by education level
. gen     ch_l = (occupation != occupation_s) if sample_1 == 1 & (occupation_s 
> > 0 & occupation_s < .) & public_job == .
(61,644 missing values generated)

. replace ch_l = . if ch_l == 0
(205 real changes made, 205 to missing)

. gen     ch_h = (occupation != occupation_s) if sample_2 == 1 & (occupation_s 
> > 0 & occupation_s < .) & public_job == .
(61,071 missing values generated)

. replace ch_h = . if ch_h == 0
(778 real changes made, 778 to missing)

. 
. 
. * c) Creates the new public_job variable
. clonevar public_job_s = public_job
(40,223 missing values generated)

. replace  public_job_s = 1 if (ch_l == 1 | ch_h == 1) 
(0 real changes made)

. ta public_job

 public_job |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     20,273       93.74       93.74
          1 |      1,353        6.26      100.00
------------+-----------------------------------
      Total |     21,626      100.00

. ta public_job_s

public_job_ |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     20,273       93.74       93.74
          1 |      1,353        6.26      100.00
------------+-----------------------------------
      Total |     21,626      100.00

. 
. *===========================================================================
. forvalues i = 1/`lim' {
  2.         sum  ch_l [aw = fexp_s] if sect_main_s== `i'
  3.         if r(sum) != 0 {
  4.                 gen  aux_l_`i' = sum(fexp_s)/r(sum) if ch_l == 1 & sect_ma
> in_s== `i'
  5.                 sort aleat_ila, stable
  6.                 replace public_job_s = 0 if  aux_l_`i' <= pj_1_`i'
  7.                 di in ye "share of private employment is ===>   pj_1_`i'  
> = " scalar(pj_1_`i')
  8.                 ta public_job_s [aw=fexp_s] if aux_l_`i' != .
  9.         }
 10. 
.         sum  ch_h [aw = fexp_s] if sect_main_s== `i'
 11.         if r(sum) != 0 {
 12.                 gen  aux_h_`i' = sum(fexp_s)/r(sum) if ch_h == 1 & sect_ma
> in_s== `i'
 13.                 sort aleat_ila, stable
 14.                 replace public_job_s = 0 if  aux_h_`i' <= pj_2_`i'
 15.                 di in ye "share of private employment is ===>   pj_2_`i'  
> = " scalar(pj_2_`i')
 16.                 ta public_job_s [aw=fexp_s] if aux_h_`i' != .
 17.         }
 18. }

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_l |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
        ch_h |       0           0

. 
. rename ch_l ch_l_pj

. rename ch_h ch_h_pj

. capture drop aux_l_*

. capture drop aux_h_*

. capture drop ch_l_sal

. capture drop ch_h_sal

. capture drop ch_l_pj

. capture drop ch_h_pj

. 
. *===========================================================================
. * II- Compute the income of employed simulated who come from other sector sta
> tus
. *===========================================================================
. 
. * Income estimation by education level
. gen  predila_n  = .
(61,849 missing values generated)

. /*
> if $m == 1 {
> 
>         forvalues n = 1/2 {
> 
>                 * linear projection
>         
>                 * Those who come from INACTIVITY
>                 mat score predila_n = b_1_`n' if occupation == 0 & occupation
> _s == 2 & sample_`n' == 1, replace
>                 mat score predila_n = b_2_`n' if occupation == 0 & occupation
> _s == 3 & sample_`n' == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 0 & occupation
> _s == 4 & sample_`n' == 1, replace
> 
>                 * Those who come from UNEMPLOYMENT
>                 mat score predila_n = b_1_`n' if occupation == 1 & occupation
> _s == 2 & sample_`n' == 1, replace
>                 mat score predila_n = b_2_`n' if occupation == 1 & occupation
> _s == 3 & sample_`n' == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 1 & occupation
> _s == 4 & sample_`n' == 1, replace
> 
>                 * Those who come from AGRICULTURE
>                 mat score predila_n = b_2_`n' if occupation == 2 & occupation
> _s == 3 & sample_`n' == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 2 & occupation
> _s == 4 & sample_`n' == 1, replace
> 
>                 * Those who come from INDUSTRY
>                 mat score predila_n = b_1_`n' if occupation == 3 & occupation
> _s == 2 & sample_`n' == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 3 & occupation
> _s == 4 & sample_`n' == 1, replace
> 
>                 * Those who come from SERVICES
>                 mat score predila_n = b_1_`n' if occupation == 4 & occupation
> _s == 2 & sample_`n' == 1, replace
>                 mat score predila_n = b_2_`n' if occupation == 4 & occupation
> _s == 3 & sample_`n' == 1, replace
> 
>                 * Those who remain in their sector but changes their informal
> ity status   
>                 mat score predila_n = b_1_`n' if occupation == 2 & occupation
> _s == 2 & sample_`n' == 1 & informal_s == 1 & informal == 0, replace
>                 mat score predila_n = b_2_`n' if occupation == 3 & occupation
> _s == 3 & sample_`n' == 1 & informal_s == 1 & informal == 0, replace
>                 mat score predila_n = b_3_`n' if occupation == 4 & occupation
> _s == 4 & sample_`n' == 1 & informal_s == 1 & informal == 0, replace
> 
>                 mat score predila_n = b_1_`n' if occupation == 2 & occupation
> _s == 2 & sample_`n' == 1 & informal_s == 0 & informal == 1, replace
>                 mat score predila_n = b_2_`n' if occupation == 3 & occupation
> _s == 3 & sample_`n' == 1 & informal_s == 0 & informal == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 4 & occupation
> _s == 4 & sample_`n' == 1 & informal_s == 0 & informal == 1, replace
>                  
>                 mat score predila_n = b_1_`n' if occupation == 2 & occupation
> _s == 2 & sample_`n' == 1 & informal_s == 1 & informal == 1, replace
>                 mat score predila_n = b_2_`n' if occupation == 3 & occupation
> _s == 3 & sample_`n' == 1 & informal_s == 1 & informal == 1, replace
>                 mat score predila_n = b_3_`n' if occupation == 4 & occupation
> _s == 4 & sample_`n' == 1 & informal_s == 1 & informal == 1, replace
> 
>                 mat score predila_n = b_1_`n' if occupation == 2 & occupation
> _s == 2 & sample_`n' == 1 & informal_s == 0 & informal == 0, replace
>                 mat score predila_n = b_2_`n' if occupation == 3 & occupation
> _s == 3 & sample_`n' == 1 & informal_s == 0 & informal == 0, replace
>                 mat score predila_n = b_3_`n' if occupation == 4 & occupation
> _s == 4 & sample_`n' == 1 & informal_s == 0 & informal == 0, replace
>                  
>                 *  Residuals   
>                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigma_1
> _`n' if occupation_s == 2 & sample_`n' == 1 
>                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigma_2
> _`n' if occupation_s == 3 & sample_`n' == 1
>                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigma_3
> _`n' if occupation_s == 4 & sample_`n' == 1
>         }
> 
>         replace predila_n = exp(predila_n)
> 
>         * Those who mantain their employment status and sector
>         gen     lai_m_s = .
>         replace lai_m_s = lai_m if occupation == 2 & occupation_s == 2       
>          
>         replace lai_m_s = .     if occupation == 2 & occupation_s == 2 & (lai
> _m == .) 
>         replace lai_m_s = lai_m if occupation == 3 & occupation_s == 3       
>          
>         replace lai_m_s = .     if occupation == 3 & occupation_s == 3 & (lai
> _m == .) 
>         replace lai_m_s = lai_m if occupation == 4 & occupation_s == 4       
>          
>         replace lai_m_s = .     if occupation == 4 & occupation_s == 4 & (lai
> _m == .) 
> 
>         * New employed who come from other sectors, non-employed or unemploye
> d 
>         replace lai_m_s = predila_n  if occupation_s == 2 & lai_m_s == .
>         replace lai_m_s = predila_n  if occupation_s == 3 & lai_m_s == .
>         replace lai_m_s = predila_n  if occupation_s == 4 & lai_m_s == .
> 
>         * Those who mantain their sectors but change their formality status
>         replace lai_m_s = predila_n  if occupation == 2 & occupation_s == 2 &
>  (lai_m == .) & informal_s == 1 & informal == 0
>         replace lai_m_s = predila_n  if occupation == 3 & occupation_s == 3 &
>  (lai_m == .) & informal_s == 1 & informal == 0
>         replace lai_m_s = predila_n  if occupation == 4 & occupation_s == 4 &
>  (lai_m == .) & informal_s == 1 & informal == 0
> 
>         replace lai_m_s = predila_n  if occupation == 2 & occupation_s == 2 &
>  (lai_m == .) & informal_s == 0 & informal == 1
>         replace lai_m_s = predila_n  if occupation == 3 & occupation_s == 3 &
>  (lai_m == .) & informal_s == 0 & informal == 1
>         replace lai_m_s = predila_n  if occupation == 4 & occupation_s == 4 &
>  (lai_m == .) & informal_s == 0 & informal == 1
> 
> }
> */
. 
. 
.         forvalues n = 1/2 {
  2. 
.                 * Linear projection
. 
.                 * Those who come from INACTIVITY
.                 mat score predila_n  = b_1_`n'  if occupation == 0 & sectorg_
> s == 1 & sample_`n' == 1, replace
  3.                 mat score predila_n  = b_2_`n'  if occupation == 0 & secto
> rg_s == 2 & sample_`n' == 1, replace
  4.                 mat score predila_n  = b_3_`n'  if occupation == 0 & secto
> rg_s == 3 & sample_`n' == 1, replace
  5.                 mat score predila_n  = b_4_`n'  if occupation == 0 & secto
> rg_s == 4 & sample_`n' == 1, replace
  6.                 mat score predila_n  = b_5_`n'  if occupation == 0 & secto
> rg_s == 5 & sample_`n' == 1, replace
  7.                 mat score predila_n  = b_6_`n'  if occupation == 0 & secto
> rg_s == 6 & sample_`n' == 1, replace
  8. 
.                 * Those who come from UNEMPLOYMENT
.                 mat score predila_n  = b_1_`n'  if occupation == 10 & sectorg
> _s == 1 & sample_`n' == 1, replace
  9.                 mat score predila_n  = b_2_`n'  if occupation == 10 & sect
> org_s == 2 & sample_`n' == 1, replace
 10.                 mat score predila_n  = b_3_`n'  if occupation == 10 & sect
> org_s == 3 & sample_`n' == 1, replace
 11.                 mat score predila_n  = b_4_`n'  if occupation == 10 & sect
> org_s == 4 & sample_`n' == 1, replace
 12.                 mat score predila_n  = b_5_`n'  if occupation == 10 & sect
> org_s == 5 & sample_`n' == 1, replace
 13.                 mat score predila_n  = b_6_`n'  if occupation == 10 & sect
> org_s == 6 & sample_`n' == 1, replace
 14. 
.                 * Those who come from Agriculture s0
.                 mat score predila_n  = b_2_`n'  if sectorg == 1 & sectorg_s =
> = 2 & sample_`n' == 1, replace
 15.                 mat score predila_n  = b_3_`n'  if sectorg == 1 & sectorg_
> s == 3 & sample_`n' == 1, replace
 16.                 mat score predila_n  = b_4_`n'  if sectorg == 1 & sectorg_
> s == 4 & sample_`n' == 1, replace
 17.                 mat score predila_n  = b_5_`n'  if sectorg == 1 & sectorg_
> s == 5 & sample_`n' == 1, replace
 18.                 mat score predila_n  = b_6_`n'  if sectorg == 1 & sectorg_
> s == 6 & sample_`n' == 1, replace
 19. 
.         * Those who come from Agriculture s1
.            mat score predila_n  = b_1_`n'  if sectorg == 2 & sectorg_s == 1 &
>  sample_`n' == 1, replace
 20.            mat score predila_n  = b_3_`n'  if sectorg == 2 & sectorg_s == 
> 3 & sample_`n' == 1, replace
 21.            mat score predila_n  = b_4_`n'  if sectorg == 2 & sectorg_s == 
> 4 & sample_`n' == 1, replace
 22.            mat score predila_n  = b_5_`n'  if sectorg == 2 & sectorg_s == 
> 5 & sample_`n' == 1, replace
 23.            mat score predila_n  = b_6_`n'  if sectorg == 2 & sectorg_s == 
> 6 & sample_`n' == 1, replace
 24.          
.                 * Those who come from Industry s0
.                 mat score predila_n  = b_1_`n'  if sectorg == 3 & sectorg_s =
> = 1 & sample_`n' == 1, replace
 25.                 mat score predila_n  = b_2_`n'  if sectorg == 3 & sectorg_
> s == 2 & sample_`n' == 1, replace
 26.                 mat score predila_n  = b_4_`n'  if sectorg == 3 & sectorg_
> s == 4 & sample_`n' == 1, replace
 27.                 mat score predila_n  = b_5_`n'  if sectorg == 3 & sectorg_
> s == 5 & sample_`n' == 1, replace
 28.                 mat score predila_n  = b_6_`n'  if sectorg == 3 & sectorg_
> s == 6 & sample_`n' == 1, replace
 29. 
.                 * Those who come from Industry s1
.                 mat score predila_n  = b_1_`n'  if sectorg == 4 & sectorg_s =
> = 1 & sample_`n' == 1, replace
 30.                 mat score predila_n  = b_2_`n'  if sectorg == 4 & sectorg_
> s == 2 & sample_`n' == 1, replace
 31.                 mat score predila_n  = b_3_`n'  if sectorg == 4 & sectorg_
> s == 3 & sample_`n' == 1, replace
 32.                 mat score predila_n  = b_5_`n'  if sectorg == 4 & sectorg_
> s == 5 & sample_`n' == 1, replace
 33.                 mat score predila_n  = b_6_`n'  if sectorg == 4 & sectorg_
> s == 6 & sample_`n' == 1, replace
 34. 
.                 * Those who come from Services s0
.                 mat score predila_n  = b_1_`n'  if occupation == 5 & sectorg_
> s == 1 & sample_`n' == 1, replace
 35.                 mat score predila_n  = b_2_`n'  if occupation == 5 & secto
> rg_s == 2 & sample_`n' == 1, replace
 36.                 mat score predila_n  = b_3_`n'  if occupation == 5 & secto
> rg_s == 3 & sample_`n' == 1, replace
 37.                 mat score predila_n  = b_4_`n'  if occupation == 5 & secto
> rg_s == 4 & sample_`n' == 1, replace
 38.                 mat score predila_n  = b_6_`n'  if occupation == 5 & secto
> rg_s == 6 & sample_`n' == 1, replace
 39. 
.         * Those who come from Services s1
.            mat score predila_n  = b_1_`n'  if occupation == 6 & sectorg_s == 
> 1 & sample_`n' == 1, replace
 40.            mat score predila_n  = b_2_`n'  if occupation == 6 & sectorg_s 
> == 2 & sample_`n' == 1, replace
 41.            mat score predila_n  = b_3_`n'  if occupation == 6 & sectorg_s 
> == 3 & sample_`n' == 1, replace
 42.            mat score predila_n  = b_4_`n'  if occupation == 6 & sectorg_s 
> == 4 & sample_`n' == 1, replace
 43.            mat score predila_n  = b_5_`n'  if occupation == 6 & sectorg_s 
> == 5 & sample_`n' == 1, replace
 44. 
.                 * Residuals   
.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigma_1
> _`n' if sectorg_s == 1 & sample_`n' == 1 
 45.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigm
> a_2_`n' if sectorg_s == 2 & sample_`n' == 1
 46.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigm
> a_3_`n' if sectorg_s == 3 & sample_`n' == 1
 47.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigm
> a_4_`n' if sectorg_s == 4 & sample_`n' == 1
 48.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigm
> a_5_`n' if sectorg_s == 5 & sample_`n' == 1
 49.                 replace   predila_n = predila_n + invnorm(aleat_ila)* sigm
> a_6_`n' if sectorg_s == 6 & sample_`n' == 1
 50.         }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(5 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
.         replace predila_n = exp(predila_n)
(5 real changes made)

. 
.         * those who mantain their employment status and sector
.         gen     lai_m_s = .
(61,849 missing values generated)

.         levelsof occupation if occupation>10, local(alloccups)
11 12 13 14 15 16

.         foreach i of local alloccups {
  2.                 * Those who mantain their employment status and sector
.                 replace lai_m_s = lai_m if occupation == `i' & occupation_s =
> = `i'                
  3.                 replace lai_m_s = .     if occupation == `i' & occupation_
> s == `i' & (lai_m == .) 
  4.                 * New employed who come from other sectors, non-employed o
> r unemployed 
.                 replace lai_m_s = predila_n  if occupation_s == `i' & lai_m_s
>  == .
  5.         }
(930 real changes made)
(0 real changes made)
(0 real changes made)
(5,159 real changes made)
(0 real changes made)
(0 real changes made)
(3,096 real changes made)
(0 real changes made)
(0 real changes made)
(1,950 real changes made)
(0 real changes made)
(0 real changes made)
(4,182 real changes made)
(0 real changes made)
(0 real changes made)
(3,554 real changes made)
(0 real changes made)
(5 real changes made)

. 
.         * 2- New employed who come from other sectors, non-employed or unempl
> oyed 
.         replace lai_m_s = predila_n  if sectorg_s == 1 & lai_m_s == .
(0 real changes made)

.         replace lai_m_s = predila_n  if sectorg_s == 2 & lai_m_s == .
(0 real changes made)

.         replace lai_m_s = predila_n  if sectorg_s == 3 & lai_m_s == .
(0 real changes made)

.         replace lai_m_s = predila_n  if sectorg_s == 4 & lai_m_s == .
(0 real changes made)

.         replace lai_m_s = predila_n  if sectorg_s == 5 & lai_m_s == .
(0 real changes made)

.         replace lai_m_s = predila_n  if sectorg_s == 6 & lai_m_s == .
(0 real changes made)

. 
. 
. 
. 
. * Summ those who do not belong to the sample
. replace lai_m_s = lai_m  if lai_m_s == . &  sectorg_s!= . & sample == .
(0 real changes made)

. replace lai_m_s = lai_m  if lai_m_s == . &  lai_m != . & sample == .
(199 real changes made)

. replace lai_m_s = lai_m  if lai_m_s == . &  lai_m != . & sample == 1
(524 real changes made)

. 
. 
. * Eliminate labor income for those who pass from employed to non-employed sta
> tus 
. replace lai_m_s = .  if active_s  == 1 & unemplyd_s  == 1 & unemplyd == 0  & 
> sample == 1
(47 real changes made, 47 to missing)

. replace lai_m_s = .  if active_s  == 0 & lf_samp     == 1                  & 
> sample == 1
(1,587 real changes made, 1,587 to missing)

. 
. drop predila_n aleat_ila

. 
. *===========================================================================
. *                                     END
. *===========================================================================
. 
end of do-file

. *!v1.0
. *===========================================================================
. * TITLE: 11 - Income growth by sector
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *===========================================================================
. * Created on : Mar 17, 2020
. * Last update: Oct 18, 2022 - Kelly Y. Montoya
. *===========================================================================
. 
. *===========================================================================
. * Getting reduction in informal workers because of quarantine 
. *===========================================================================
. /*
> if $t == 2 {
> 
>    replace lai_m_s = lai_m * (1 - (lai_m * ( $redu )/(lai_m * 12))) if inform
> al_s == 1
> 
> } */
. *===========================================================================
. * I. Calculates the growth rate by sector of total labor income 
. *    (main and secondary for everybody)
. *===========================================================================
. 
. sum sectorg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     sectorg |     21,327    3.846861     1.59241          1          6

. loc lim = r(max)

. 
. forvalues i = 1/`lim' {
  2.         
.         //Base
.         sum lai_m     [aw = wgt]  if lai_m > 0 & lai_m < . & sectorg    == `i
> ' 
  3.         sca sp_`i' = r(mean)
  4. 
.         //Scenario
.         sum lai_m_s [aw = fexp_s]  if lai_m_s > 0 & lai_m_s < . & sectorg_s==
>  `i' 
  5.         sca sp1_`i' = r(mean)
  6. 
.         if `i' == 1 { 
  7.                 mat var0 = sp_`i' 
  8.                 mat var1 = sp1_`i' 
  9.                 mat list var0
 10.                 mat list var1
 11.         }
 12. 
.         if `i' != 1 {
 13.                 mat var0 = var0\sp_`i'
 14.                 mat var1 = var1\sp1_`i' 
 15.                 mat list var0
 16.                 mat list var1
 17.         
.         } 
 18. }

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |     861  2651368.39    7.566606   15.21714   2.36e-17   160.3937

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |     758     2487673    8.101346   15.71088   2.36e-17   160.3937

symmetric var0[1,1]
           c1
r1  7.5666061

symmetric var1[1,1]
           c1
r1  8.1013457

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |   4,805  14247473.1    10.04319   95.64286   .0030051   5640.807

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   4,173    13019465    10.87885   101.5282   .0034666   5640.807

var0[2,1]
           c1
r1  7.5666061
r2  10.043193

var1[2,1]
           c1
r1  8.1013457
r2  10.878853

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |   3,554  10220423.7    15.81455    121.983   .0069332   4710.683

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,088     9532697    16.92753   128.1616   .0069332   4710.683

var0[3,1]
           c1
r1  7.5666061
r2  10.043193
r3  15.814552

var1[3,1]
           c1
r1  8.1013457
r2  10.878853
r3  16.927535

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |   1,969  5885512.64    21.61403   98.77751   .1682317   2907.084

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   1,899     5929998    21.90953   99.87369   .3119933   2907.084

var0[4,1]
           c1
r1  7.5666061
r2  10.043193
r3  15.814552
r4  21.614032

var1[4,1]
           c1
r1  8.1013457
r2  10.878853
r3  16.927535
r4  21.909532

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |   4,181  10341909.4    12.89326   16.88745   .0069332    511.669

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,976    10436043    12.96093   16.75677   .0069332    511.669

var0[5,1]
           c1
r1  7.5666061
r2  10.043193
r3  15.814552
r4  21.614032
r5  12.893258

var1[5,1]
           c1
r1  8.1013457
r2  10.878853
r3  16.927535
r4  21.909532
r5  12.960927

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |   3,546  8135846.89     36.5172   271.5647   .0066559   7571.038

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,449     8438914    35.96248   270.7332   .0066559   7571.038

var0[6,1]
           c1
r1  7.5666061
r2  10.043193
r3  15.814552
r4  21.614032
r5  12.893258
r6    36.5172

var1[6,1]
           c1
r1  8.1013457
r2  10.878853
r3  16.927535
r4  21.909532
r5  12.960927
r6  35.962483

. 
. 
. *===========================================================================
. * Calculates the difference between simulated and projected income growth rat
> es by sector (This uses income projected with elasticities - input_gdp2)
. *===========================================================================
. 
. sum sectorg

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     sectorg |     21,327    3.846861     1.59241          1          6

. loc lim2 = r(max)

. 
. mat growth_ila_rel = growth_labor_income[1..`lim2',1]

. 
. mat list growth_ila_rel 

growth_ila_rel[6,1]
          rate
r1  -.10501863
r2   .00855629
r3  -.19796824
r4     -.10908
r5   -.0536348
r6  -.01533078

. mata:
------------------------------------------------- mata (type end to exit) -----
: M = st_matrix("var0")

: V = st_matrix("growth_ila_rel")

: C = st_matrix("var1")

: G = M:*(1:+V)

: H = (G:/C):-1

: st_matrix("growth_ila_rel_n",H)

: end
-------------------------------------------------------------------------------

. 
. mat list growth_ila_rel_n

growth_ila_rel_n[6,1]
            c1
r1  -.16409302
r2  -.06891599
r3   -.2507017
r4  -.12109611
r5  -.05857579
r6  -.00014236

. 
. 
. *===========================================================================
. * Expands income labor by sector
. *===========================================================================
. 
. clonevar lai_s_s = lai_s 
(54,846 missing values generated)

. 
. //Main
.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[1,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 1 
(758 real changes made)

.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[2,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 2 
(4,173 real changes made)

.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[3,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 3 
(3,088 real changes made)

.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[4,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 4 
(1,899 real changes made)

.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[5,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 5 
(3,976 real changes made)

.    replace lai_m_s = lai_m_s * (1 + growth_ila_rel_n[6,1]) if lai_m_s > 0 & l
> ai_m_s != .   & sectorg_s == 6 
(3,449 real changes made)

.  
. //Secondary 
.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[1,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 1 
(1,553 real changes made)

.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[2,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 2 
(1,745 real changes made)

.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[3,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 3 
(673 real changes made)

.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[4,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 4 
(400 real changes made)

.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[5,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 5 
(447 real changes made)

.    replace lai_s_s = lai_s_s * (1 + growth_ila_rel_n[6,1]) if lai_s_s > 0 & l
> ai_s_s != .   & sect_secu == 6 
(652 real changes made)

.   
. 
. * Check the variations
. forvalues i = 1/`lim' {
  2.         sum lai_m_s [aw = fexp_s] if lai_m_s > 0 & lai_m_s < . & sectorg_s
>  == `i' 
  3.         sca sp2_`i' = r(mean)
  4.         //sca s1_`i' = scalar(sp_`i') + scalar(ss_`i')
. }

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |     758     2487673    6.771971   13.13283   1.98e-17   134.0742

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   4,173    13019465    10.12913   94.53124   .0032277   5252.065

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,088     9532697    12.68377   96.03129    .005195   3529.707

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   1,899     5929998    19.25637   87.77937   .2742122   2555.048

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,976    10436043    12.20173   15.77523   .0065271   481.6976

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |   3,449     8438914    35.95736   270.6946   .0066549    7569.96

. mat n =   scalar(sp2_1)/scalar(sp_1)-1

. mat n = n\scalar(sp2_2)/scalar(sp_2)-1

. mat n = n\scalar(sp2_3)/scalar(sp_3)-1

. mat n = n\scalar(sp2_4)/scalar(sp_4)-1

. mat n = n\scalar(sp2_5)/scalar(sp_5)-1

. mat n = n\scalar(sp2_6)/scalar(sp_6)-1

. 
. mat diff  = growth_ila_rel - n

. mat check = growth_ila_rel,n,diff

. mat list check

check[6,3]
          rate          c1          c1
r1  -.10501863  -.10501863   1.110e-16
r2   .00855629   .00855629   2.220e-16
r3  -.19796824  -.19796824  -1.110e-16
r4     -.10908     -.10908   1.110e-16
r5   -.0536348   -.0536348           0
r6  -.01533078  -.01533078  -2.220e-16

. 
. 
. *===========================================================================
. * Re-scale all incomes by the average income 
. *===========================================================================
. 
. sum     lai_m [aw = wgt] if lai_m > 0 & lai_m != . & sectorg != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |  18,916  51482534.1    17.14042   135.6633   2.36e-17   7571.038

. loc tot_ila_s = r(mean)

. sum lai_m_s [aw = fexp_s] if lai_m_s > 0 & lai_m_s!=. & sectorg_s != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |  17,343    49844790    16.34277   132.5284   1.98e-17    7569.96

. replace lai_m_s = `tot_ila_s' * (lai_m_s / r(mean)) if sectorg_s != .
(17,766 real changes made)

. 
. sum     lai_s [aw = wgt] if lai_s > 0 & lai_s != . & sectorg != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_s |   5,704  15394714.3    2.646513   5.227174   .0000539   153.9647

. loc tot_ila_s = r(mean)

. sum lai_s_s [aw = fexp_s] if lai_s_s > 0 & lai_s_s!=. & sectorg_s != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_s_s |   5,693    15834857    2.408806   4.926763   .0000404   153.9428

. replace lai_s_s = `tot_ila_s' * (lai_s_s / r(mean)) if sectorg_s != .
(6,926 real changes made)

. 
. loc r = rowsof(growth_labor_income)

. mat growth_ila_tot = growth_labor_income[`r',1]

. 
. mat list growth_ila_tot

symmetric growth_ila_tot[1,1]
            c1
r1  -.05449499

. 
. replace lai_m_s = lai_m_s * (1 + growth_ila_tot[1,1]) if lai_m_s > 0 & lai_m_
> s != . & sectorg_s != .
(17,343 real changes made)

. 
. replace lai_s_s = lai_s_s * (1 + growth_ila_tot[1,1]) if lai_s_s > 0 & lai_s_
> s != . & sectorg_s != .
(5,693 real changes made)

. 
. * Checking 
. sum lai_m [aw = wgt] if lai_m > 0 & lai_m < . & sectorg != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |  18,916  51482534.1    17.14042   135.6633   2.36e-17   7571.038

. sca s0 = r(mean)

. 
. sum lai_m_s [aw = fexp_s] if lai_m_s > 0 & lai_m_s < . & sectorg_s != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |  17,343    49844790    16.20635   131.4222   1.96e-17   7506.772

. sca s1 = r(mean)

. 
. di scalar(s1)/scalar(s0)-1
-.05449499

. mat list growth_ila_tot

symmetric growth_ila_tot[1,1]
            c1
r1  -.05449499

. 
. sum lai_s [aw = wgt] if lai_s > 0 & lai_s < . & sectorg != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_s |   5,704  15394714.3    2.646513   5.227174   .0000539   153.9647

. sca s0 = r(mean)

. 
. sum lai_s_s [aw = fexp_s] if lai_s_s > 0 & lai_s_s < . & sectorg_s != .

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_s_s |   5,693    15834857    2.502291   5.117968   .0000419   159.9172

. sca s1 = r(mean)

. 
. di scalar(s1)/scalar(s0)-1
-.05449499

. mat list growth_ila_tot

symmetric growth_ila_tot[1,1]
            c1
r1  -.05449499

. 
. 
. *===========================================================================
. *                                     END
. *===========================================================================
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 12 - Total labor income
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *============================================================================
> =
. 
. *============================================================================
> =
. 
. capture drop aux1

. capture drop aux2

. capture drop tot_lai_s

. 
. egen    aux1    = rsum(lai_m lai_s) , m
(42,249 missing values generated)

. replace aux1 = lai_s if lai_m < 0  
(491 real changes made, 484 to missing)

. replace aux1 = aux1 *-1
(19,116 real changes made)

. egen    aux2 = rsum(lai_m_s lai_s_s), m
(43,485 missing values generated)

. replace aux2 = lai_s_s if lai_m_s < 0  
(430 real changes made, 423 to missing)

. 
. *egen tot_lai = rsum(lai_m lai_s), m
. 
. egen tot_lai_s = rowtotal(tot_lai aux1 aux2), missing 
(42,733 missing values generated)

. 
. * Checking 
. sum lai_m [aw = wgt] if lai_m > 0 & lai_m < . 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_m |  19,108  52011349.5    17.02711   134.9784   2.36e-17   7571.038

. sca sp = r(sum)

. sum lai_s [aw = wgt] if lai_s > 0 & lai_s < . 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
       lai_s |   5,757  15508628.9    2.641586    5.23617   .0000539   153.9647

. sca ss = r(sum)

. sca s0 = scalar(sp) + scalar(ss)

. 
. sum lai_m_s [aw = fexp_s] if lai_m_s > 0 & lai_m_s < . 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_m_s |  17,535    50389767    16.09593   130.7159   1.96e-17   7506.772

. sca sp = r(sum)

. sum lai_s_s [aw = fexp_s] if lai_s_s > 0 & lai_s_s < . 

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
     lai_s_s |   5,757    15982168     2.49864   5.124888   .0000419   159.9172

. sca ss = r(sum)

. sca s1 = scalar(sp) + scalar(ss)

. 
. loc r = rowsof(growth_macro_data)

. mat growth_ila_tot = growth_macro_data[`r',1]

. di scalar(s1)/scalar(s0)-1
-.08155536

. mat list growth_ila_tot

symmetric growth_ila_tot[1,1]
          c1
r1  .1569187

. drop aux1 aux2

. 
. *============================================================================
> *
. *                                                                       END
. *============================================================================
> *
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 12  Non-labor income
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Jul 11, 2022
. * Last update: Jul 18, 2022
. *============================================================================
> =
. * Modified by: Kelly Y. Montoya (kmontoyamunoz@worldbank.org)
. *                          Jul 18, 2022 - Adapted the ECU version to the full
>  project.
. *============================================================================
> =
. 
. 
. *============================================================================
> =
. * A. Private transfers
. *============================================================================
> =
. 
. loc nl_incomes "remesas pensions capital transfers"

. loc lim : word count `nl_incomes'

. dis `lim'
4

. 
. forvalues i = 1/`lim' {
  2. loc x : word `i' of `nl_incomes'
  3. 
. dis as text "{hline}" _newline ///
>         as text " nl income = `x'" _newline ///
>     as text "{hline}" _newline
  4. 
. *  1. calculates the growth rate of capital according to population growth 
. sum h_`x' [aw = wgt  ] if h_`x' > 0 & h_`x' <.
  5. mat var0 = r(sum) / 1000000
  6. sum h_`x' [aw = fexp_s] if h_`x' > 0 & h_`x' <.
  7. mat var1 = r(sum) / 1000000
  8. 
. * 2. calculates the difference between micro and macro data growth rates  
. mat growth_`x' = growth_nlabor[`i',1]
  9. 
. }
-------------------------------------------------------------------------------
 nl income = remesas
-------------------------------------------------------------------------------


    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   h_remesas |   5,835  14841153.9     3.24238   8.317676   .0001387   138.6637

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   h_remesas |   5,835    15294458    3.242364   8.317668   .0001387   138.6637
-------------------------------------------------------------------------------
 nl income = pensions
-------------------------------------------------------------------------------


    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  h_pensions |       0           0

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
  h_pensions |       0           0
-------------------------------------------------------------------------------
 nl income = capital
-------------------------------------------------------------------------------


    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   h_capital |   3,319  8565516.44    5.794979   10.75295   .0001387   135.3357

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
   h_capital |   3,319     8827209    5.795065   10.75305   .0001387   135.3357
-------------------------------------------------------------------------------
 nl income = transfers
-------------------------------------------------------------------------------


    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
 h_transfers |   5,792  15147684.2    .8589167   2.929485    .000208   38.52077

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
 h_transfers |   5,792    15610201    .8589305   2.929531    .000208   38.52077

. 
. mata:
------------------------------------------------- mata (type end to exit) -----
: M = st_matrix("var0")

: C = st_matrix("var1")

: V = st_matrix("growth_remesas")

: G = M:*(1:+V)

: H = (G:/C):-1

: st_matrix("growth_remesas_adjust",H)

: end
-------------------------------------------------------------------------------

. 
. mata:
------------------------------------------------- mata (type end to exit) -----
: M = st_matrix("var0")

: C = st_matrix("var1")

: V = st_matrix("growth_pensions")

: G = M:*(1:+V)

: H = (G:/C):-1

: st_matrix("growth_pensions_adjust",H)

: end
-------------------------------------------------------------------------------

. 
. mata:
------------------------------------------------- mata (type end to exit) -----
: M = st_matrix("var0")

: C = st_matrix("var1")

: V = st_matrix("growth_capital")

: G = M:*(1:+V)

: H = (G:/C):-1

: st_matrix("growth_capital_adjust",H)

: end
-------------------------------------------------------------------------------

. 
. mata:
------------------------------------------------- mata (type end to exit) -----
:         M = st_matrix("var0")

:         C = st_matrix("var1")

:         V = st_matrix("growth_transfers")

:         G = M:*(1:+V)

:         H = (G:/C):-1

:         st_matrix("growth_transfers_adjust",H)

: end
-------------------------------------------------------------------------------

. 
. 
. foreach x of local nl_incomes {
  2.     dis as text "`x'"
  3. * 3. expands private tranfers according to the new growth rate 
. gen  h_`x'_s = h_`x' *(1 + growth_`x'_adjust[1,1] ) if h_`x' !=.
  4. 
. }
remesas
(56,014 missing values generated)
pensions
(61,849 missing values generated)
capital
(58,530 missing values generated)
transfers
(56,057 missing values generated)

. 
. * others non-labor transfers  
. gen  h_otherinla_s  = h_otherinla
(61,139 missing values generated)

. //gen h_privtrans_s = h_privtrans
. 
. 
. * imputed rent
. gen h_renta_imp_s = h_renta_imp
(52,827 missing values generated)

. 
. * Adjustment done by KM
. egen aux_nlai_s = rowtotal(h_remesas_s h_pensions_s h_capital_s h_renta_imp_s
>  h_otherinla_s h_transfers_s) if h_head == 1, missing
(49,331 missing values generated)

. bysort id: egen h_nlai_s = sum(aux_nlai_s) if h_head != ., m
(7,087 missing values generated)

. 
. 
. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 14 - Household income
. *===========================================================================
. * Prepared by: Sergio Olivieri
. * E-mail: solivieri@worldbank.org
. *============================================================================
> =
. * Created on : Mar 17, 2020
. * Last update: Jan 04, 2021
. *============================================================================
> =
. * Modified by: Kelly Y. Montoya
. * Modification: 04/29/2022 - Correcting household non-labor income
. *                               07/26/2022 - Corrected household labor income
. *                               08/30/2022 - Corrected missing household labo
> r income
. *============================================================================
> =
. 
. note: total individual incomes before food price adjustment 

. *============================================================================
> =
. 
. * Labor
. * Observed 
. gen     h_lai_obs = h_lai * -1
(3,387 missing values generated)

. replace h_lai_obs = . if h_lai_obs == 0 
(0 real changes made)

. * Counterfactual
. *egen     h_lai_s = sum(tot_lai_s) , by(hhid)
. egen     h_lai_s = sum(tot_lai_s) if h_head != ., by(hhid) m // KM: I correct
> ed this.
(3,387 missing values generated)

. *replace  h_lai_s = .  if h_lai_s == 0
. 
. * KM: I modified this part
. * Non-labor
. * Observed
. bysort id: egen aux_nlai = sum(h_nlai), m
(6,626 missing values generated)

. cap drop h_nlai

. gen h_nlai = aux_nlai
(6,626 missing values generated)

. drop aux_nlai

. 
. gen     h_nlai_obs = h_nlai * -1
(6,626 missing values generated)

. replace h_nlai_obs = . if h_nlai_obs == 0 
(0 real changes made)

. * Counterfactual
. *replace  h_nlai_s = .  if h_nlai_s == 0
. 
. * Total
. egen     h_inc_s = rowtotal(h_inc h_lai_obs h_lai_s h_nlai_obs h_nlai_s) if h
> _head != ., missing 

. 
. replace  h_inc_s = 0 if h_inc_s < 0
(632 real changes made)

. *replace  h_inc_s = . if h_inc_s == 0
. replace  h_inc_s = . if h_inc == .
(0 real changes made)

. 
. * per capita household income - total
. gen       pc_inc_s = h_inc_s/ h_size

. label var pc_inc_s "per capita income - $scenario" 

. 
. 
. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
end of do-file

. *!v1.0
. *============================================================================
> =
. * TITLE: 14 - Household consumption
. *===========================================================================
. * Prepared by: Israel Osorio-Rodarte
. * E-mail: iosoriorodarte@worldbank.org
. *============================================================================
> =
. * Created on : Sep 06, 2024
. * Last update: Sep 06, 2024
. *============================================================================
> =
. * Modified by: 
. * Modification: 
. *============================================================================
> =
. 
. 
. * Generate original welfare aggregate
.         gen double welfare_ppp17 = ((12/365)*welfarenat/cpi2017/icp2017)

. 
. * Quintiles at the national level
.         xtile ntiles = welfare_ppp17 [w=wgt], nq(5)
(analytic weights assumed)

. 
. * Variables head, and age of househhold head
.         gen head = (relationharm==1)

.         gen _agehead = age if head==1
(47,579 missing values generated)

.         bys hhid: egen agehead = median(_agehead)

.         drop _agehead

. 
. * Income to consumption ratio (original)
.         gen double ratio_orig = (ipcf_ppp17/welfare_ppp17)

.         
. * Impute missing values for male - there shouldn't be any missing values in i
> ndependent vars
.         replace male = 0 if male==.     
(30,855 real changes made)

.                 
. * Classifying househhold into 4 different cases for changes in per capita inc
> ome
.         gen case = .
(61,849 missing values generated)

. 
.         replace case =                  0 if (round(ipcf_ppp17,.1)==round(pc_
> inc_s,.1)) // Remained with the same income, including zero
(10,186 real changes made)

.         replace case =                  1 if (ipcf_ppp17> 0 & ipcf_ppp17!=.) 
> & ///
>                                                                  (pc_inc_s> 0
>  & pc_inc_s!=.)     & ///
>                                                                  case!=0     
>                       // Remained with positive income
(51,444 real changes made)

.         replace case =                  2 if (ipcf_ppp17==0                ) 
> & (pc_inc_s> 0 & pc_inc_s!=.)      & case!=0 // Turned to positive income
(53 real changes made)

.         replace case =                  3 if (ipcf_ppp17> 0 & ipcf_ppp17!=.) 
> & (pc_inc_s==0              )      & case!=0 // Turned to income equal to zer
> o
(166 real changes made)

.         
.         label define lblcase 0 "Case 0: X=X' -> Y'=Y", add

.         label define lblcase 1 "Case 1: X>0, X'>0, Y>0 -> Y'=Y(X'/X)", add

.         label define lblcase 2 "Case 3: X=0, X'>0, Y>0 -> Y'= n.n.f(determina
> nts|Y'>Y)", add

.         label define lblcase 3 "Case 4: X>0, X'=0, Y>0 -> Y'= n.n.f(determina
> nts|Y'<Y)", add    

.         label values case lblcase

.         
.         gen double nwf = . 
(61,849 missing values generated)

.         label var nwf "New Welfare at household head level (bridge)"

. 
. 
. * Treatment for Case 0: Since initial and final per capita income are equal, 
> household will continue with
. *                                          the same per capita consumption
.         replace nwf = welfare_ppp17 if case==0
(10,186 real changes made)

.         
. * Treatment for Case 1: Look for a similar household and import their origina
> l
. * income to consumption ratio.
.                 
.         
. * Treatement for Case 2: Household will be matched with the most similar hous
> ehold considering a higher per capita consumption
.         gen byte case2_treated = .
(61,849 missing values generated)

.         replace  case2_treated = 0 if (ipcf_ppp17> 0 & ipcf_ppp17!=.)        
>                                                    // Not treated: Households
>  with initial positive income
(60,646 real changes made)

.         replace  case2_treated = 1 if (ipcf_ppp17==0                ) & (pc_i
> nc_s> 0 & pc_inc_s!=.)     // Treated: Households that turned to positive inc
> ome
(171 real changes made)

. 
. * Treatement for Case 3. Household will be matched with the most similar hous
> ehold considering a lower per capita consumption
.         gen byte case3_treated = .
(61,849 missing values generated)

.         replace  case3_treated = 0 if (ipcf_ppp17==0 | (ipcf_ppp17>0 & ipcf_p
> pp17!=.))                          // Not treated: Households with initial wi
> th zero income
(61,849 real changes made)

.         replace  case3_treated = 1 if (ipcf_ppp17> 0 & ipcf_ppp17!=.) & (pc_i
> nc_s==0              )     // Trated: Households that turned to income equal 
> to zero
(178 real changes made)

.         
. * Case 1
.         * Setting up the Sample B. Receiver. 
.                 * Cloning the simulated per capita income
.                 clonevar ratio_outcome = ratio_orig

.                 clonevar pc_inc_match  = ipcf_ppp17

.         
.                 local vars_order "hhid pid"

.                 local vars_match "agehead hsize pc_inc_match"

.                 local vars_group "region ntile urban"

.                 local vars_addit "ipcf_ppp17 pc_inc_s welfare_ppp17 ratio_ori
> g ratio_outcome"

.                 
.                 
.                 frame put ratio_orig `vars_order' `vars_match' `vars_group' `
> vars_addit' if case==1 & h_head==1, into(matreceiver)

.                 frame matreceiver {
.                         gen case1_treated = 0
.                 }

.                 
.         * Setting Sample A. Donor.
.                 frame copy matreceiver matdonor , replace
(note: frame matdonor not found)

.                 frame matdonor {
.                         replace case1_treated = 1
(11,873 real changes made)
.                         replace pc_inc_match  = pc_inc_s
(11,873 real changes made)
.                         replace ratio_outcome = (pc_inc_s/welfare_ppp17)
(11,873 real changes made)
.                 }

.         
.         * Append both samples
.         frame change matreceiver

.         myfrappend _all, from(matdonor)
Number of observations (_N) was 11,873, now 23,746.
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)
(11,873 real changes made)

.         frame change default

.         
.         
.         frame matreceiver {
.                 
.                 egen g = group(`vars_group')
.                 gen double ratio_sim = .
(23,746 missing values generated)
.                 levelsof g, local(allvarsgroup)
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 3
> 0 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 
> 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80
.         
.                 foreach gr of local allvarsgroup {
  2.                         
.                         sort case1_treated `vars_order'
  3.                         replace ratio_sim = 3
  4.                         cap psmatch2 case1_treated `vars_match' if g==`gr'
> , neighbor(1) outcome(ratio_outcome)
  5.                         if _rc {
  6.                                 * pc_inc_math predicts data perfectly. Kee
> p the same ratio_sim
.                                 replace ratio_sim = ratio_outcome
  7.                         }
  8.                         else {
  9.                                 replace ratio_sim = _ratio_outcome  if g==
> `gr' & case1_treated==1
 10.                                 drop _*
 11.                         }
 12.                 }
(23,746 real changes made)
(225 real changes made)
(225 real changes made)
(144 real changes made)
(144 real changes made)
(172 real changes made)
(172 real changes made)
(163 real changes made)
(163 real changes made)
(165 real changes made)
(165 real changes made)
(129 real changes made)
(129 real changes made)
(123 real changes made)
(123 real changes made)
(136 real changes made)
(136 real changes made)
(65 real changes made)
(65 real changes made)
(154 real changes made)
(154 real changes made)
(105 real changes made)
(105 real changes made)
(42 real changes made)
(42 real changes made)
(114 real changes made)
(114 real changes made)
(85 real changes made)
(85 real changes made)
(130 real changes made)
(130 real changes made)
(112 real changes made)
(112 real changes made)
(144 real changes made)
(144 real changes made)
(196 real changes made)
(196 real changes made)
(143 real changes made)
(143 real changes made)
(327 real changes made)
(327 real changes made)
(90 real changes made)
(90 real changes made)
(30 real changes made)
(30 real changes made)
(128 real changes made)
(128 real changes made)
(72 real changes made)
(72 real changes made)
(148 real changes made)
(148 real changes made)
(157 real changes made)
(157 real changes made)
(208 real changes made)
(208 real changes made)
(178 real changes made)
(178 real changes made)
(195 real changes made)
(195 real changes made)
(371 real changes made)
(371 real changes made)
(159 real changes made)
(159 real changes made)
(74 real changes made)
(74 real changes made)
(187 real changes made)
(187 real changes made)
(141 real changes made)
(141 real changes made)
(161 real changes made)
(161 real changes made)
(144 real changes made)
(144 real changes made)
(139 real changes made)
(139 real changes made)
(163 real changes made)
(163 real changes made)
(114 real changes made)
(114 real changes made)
(251 real changes made)
(251 real changes made)
(221 real changes made)
(221 real changes made)
(115 real changes made)
(115 real changes made)
(159 real changes made)
(159 real changes made)
(130 real changes made)
(130 real changes made)
(144 real changes made)
(144 real changes made)
(121 real changes made)
(121 real changes made)
(113 real changes made)
(113 real changes made)
(159 real changes made)
(159 real changes made)
(65 real changes made)
(65 real changes made)
(196 real changes made)
(196 real changes made)
(149 real changes made)
(149 real changes made)
(100 real changes made)
(100 real changes made)
(193 real changes made)
(193 real changes made)
(142 real changes made)
(142 real changes made)
(189 real changes made)
(189 real changes made)
(150 real changes made)
(150 real changes made)
(154 real changes made)
(154 real changes made)
(170 real changes made)
(170 real changes made)
(107 real changes made)
(107 real changes made)
(216 real changes made)
(216 real changes made)
(262 real changes made)
(262 real changes made)
(151 real changes made)
(151 real changes made)
(161 real changes made)
(161 real changes made)
(133 real changes made)
(133 real changes made)
(139 real changes made)
(139 real changes made)
(147 real changes made)
(147 real changes made)
(92 real changes made)
(92 real changes made)
(147 real changes made)
(147 real changes made)
(56 real changes made)
(56 real changes made)
(159 real changes made)
(159 real changes made)
(183 real changes made)
(183 real changes made)
(57 real changes made)
(57 real changes made)
(185 real changes made)
(185 real changes made)
(125 real changes made)
(125 real changes made)
(120 real changes made)
(120 real changes made)
(184 real changes made)
(184 real changes made)
(129 real changes made)
(129 real changes made)
(164 real changes made)
(164 real changes made)
(84 real changes made)
(84 real changes made)
(218 real changes made)
.                 
.                 keep if case1_treated==1
(11,873 observations deleted)
.                 
.                 
.         }

.         
.         frlink m:1 hhid, frame(matreceiver)
(10,405 observations in frame default unmatched)

.         frget ratio_sim = ratio_sim, from(matreceiver)
(10,405 missing values generated)
(1 variable copied from linked frame)

.         
.         frame drop matreceiver matdonor

.         drop matreceiver

.         drop pc_inc_match ratio_outcome

.         
.         replace ratio_sim = ratio_orig * 1.2 if (ratio_sim/ratio_orig)>1.2
(59,330 real changes made)

.         replace ratio_sim = ratio_orig * 0.8 if (ratio_sim/ratio_orig)<0.8
(1,064 real changes made)

.         
.         replace nwf = pc_inc_s / ratio_sim if case==1
(51,444 real changes made)

.         */
.         *replace nwf = welfare_ppp17 * (pc_inc_s/ipcf_ppp17)  if case==1     
>    // This was the default
.         
. * Case 2
. 
.         sum case2_treated

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
case2_trea~d |     60,817    .0028117    .0529514          0          1

.         if r(mean)>0 & r(mean)!=. {
.                 sort hhid pid
.                 psmatch2 case2_treated agehead male hsize educ_level i.urban 
> i.ntiles if head==1 & case2_treated!=., neighbor(1) noreplacement

Probit regression                                       Number of obs = 13,954
                                                        LR chi2(9)    =  38.23
                                                        Prob > chi2   = 0.0000
Log likelihood = -278.22642                             Pseudo R2     = 0.0643

------------------------------------------------------------------------------
case2_trea~d | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
     agehead |    .006979   .0037324     1.87   0.062    -.0003363    .0142944
        male |    .362979   .2053333     1.77   0.077    -.0394669    .7654248
       hsize |  -.0686261    .033833    -2.03   0.043    -.1349376   -.0023146
  educ_level |  -.0602091    .034641    -1.74   0.082    -.1281042    .0076859
             |
       urban |
      Urban  |  -.4193841   .1220949    -3.43   0.001    -.6586858   -.1800824
             |
      ntiles |
          2  |  -.0238019   .1905039    -0.12   0.901    -.3971827    .3495789
          3  |   .2533731   .1682016     1.51   0.132    -.0762959    .5830421
          4  |   .0028175   .1942097     0.01   0.988    -.3778265    .3834615
          5  |   .3424135   .1811292     1.89   0.059    -.0125932    .6974201
             |
       _cons |  -2.946575   .3233061    -9.11   0.000    -3.580243   -2.312906
------------------------------------------------------------------------------
.                 
.                 levelsof _id if _treated==1, local(allids)      
13911 13912 13913 13914 13915 13916 13917 13918 13919 13920 13921 13922 13923 1
> 3924 13925 13926 13927 13928 13929 13930 13931 13932 13933 13934 13935 13936 
> 13937 13938 13939 13940 13941 13942 13943 13944 13945 13946 13947 13948 13949
>  13950 13951 13952 13953 13954
.                 
.                 foreach id of local allids {
  2.                         
.                         noi di "`id'"
  3.                         sum _pscore if _id==`id'
  4.                                 scalar ps`id' = r(mean)
  5.                         sum welfare_ppp17 if _id==`id'
  6.                                 scalar wf`id' = r(mean)
  7.                         
.                         gen double _psd`id' = abs(_pscore - ps`id') if _treat
> ed==0 & welfare_ppp17>wf`id'
  8.                                 sum _psd`id'
  9.                                 scalar mind`id' = r(min)
 10.                         count if _psd`id' == mind`id'
 11.                         
.                         if r(N)==0 {
 12.                                 noi di "No matching for `id'. Error"
 13.                                 error 1
 14.                         }
 15.                         if r(N)==1 {
 16.                                 sum welfare_ppp17 if _psd`id'==mind`id'
 17.                                 replace nwf = r(mean) if _id==`id'
 18.                         }
 19.                         if r(N)> 1 & r(N)!=. {
 20.                                 noi di "Select one, randomly"
 21.                                 gen _rd = runiform() if _psd`id' == mind`i
> d'
 22.                                 sum _rd
 23.                                         sum welfare_ppp17 if _rd == r(min)
>       
 24.                                         replace nwf = r(mean) if _id==`id'
 25.                                 drop _rd
 26.                         }
 27.                         
.                         drop _psd`id'
 28.                 }
13911

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0010659           .   .0010659   .0010659

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.861848           .   8.861848   8.861848
(59,641 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13911 |      2,208    .0029605    .0041968   1.22e-06   .0289662
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.34531           .   10.34531   10.34531
(1 real change made)
13912

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0011374           .   .0011374   .0011374

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.665884           .   8.665884   8.665884
(59,515 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13912 |      2,334    .0029733    .0042485   7.98e-07   .0288947
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    11.95489           .   11.95489   11.95489
(1 real change made)
13913

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0015564           .   .0015564   .0015564

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.348871           .   4.348871   4.348871
(53,507 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13913 |      8,342    .0025767    .0036065   2.28e-07   .0284757
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    9.383071           .   9.383071   9.383071
(1 real change made)
13914

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0017606           .   .0017606   .0017606

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.105016           .   6.105016   6.105016
(56,923 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13914 |      4,926    .0023869    .0035306   7.39e-07   .0282715
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .2018562    .2105558   .0529707   .3507416

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.812099           .   7.812099   7.812099
(1 real change made)
13915

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0019188           .   .0019188   .0019188

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.32271           .   10.32271   10.32271
(60,320 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13915 |      1,529    .0024973    .0037365   6.73e-06   .0236625
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.97614           .   10.97614   10.97614
(1 real change made)
13916

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0019199           .   .0019199   .0019199

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.941601           .   2.941601   2.941601
(50,019 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13916 |     11,830    .0022644    .0031044   5.46e-07   .0281122
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3     .756879    .1962078   .5513522   .9422048

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.482403           .   5.482403   5.482403
(1 real change made)
13917

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0020502           .   .0020502   .0020502

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.369223           .   3.369223   3.369223
(51,083 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13917 |     10,766    .0023432    .0031596          0   .0279819
  4
Select one, randomly
(61,845 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          4    .4467119    .3214185   .2516075   .9245579

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.148654           .   4.148654   4.148654
(1 real change made)
13918

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0022019           .   .0022019   .0022019

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     2.95538           .    2.95538    2.95538
(50,050 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13918 |     11,799    .0022701     .002993   2.39e-07   .0278302
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    9.265712           .   9.265712   9.265712
(1 real change made)
13919

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0023113           .   .0023113   .0023113

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.175721           .   3.175721   3.175721
(50,603 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13919 |     11,246    .0023214    .0030002          0   .0277208
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.890306           .   3.890306   3.890306
(1 real change made)
13920

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0023807           .   .0023807   .0023807

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.264562           .   2.264562   2.264562
(48,718 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13920 |     13,131    .0022074    .0028132   7.89e-07   .0276514
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3119215    .0382118   .2849016   .3389413

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.559168           .   3.559168   3.559168
(1 real change made)
13921

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0025122           .   .0025122   .0025122

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.536767           .   3.536767   3.536767
(51,511 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13921 |     10,338     .002413    .0030124   1.83e-07   .0275199
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.26512           .   10.26512   10.26512
(1 real change made)
13922

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0026538           .   .0026538   .0026538

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.549707           .   4.549707   4.549707
(53,997 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13922 |      7,852    .0025157    .0030803   1.03e-06   .0273783
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .5185503     .213797   .3673731   .6697276

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.424286           .   7.424286   7.424286
(1 real change made)
13923

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0027605           .   .0027605   .0027605

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.350341           .   3.350341   3.350341
(51,034 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13923 |     10,815    .0024241    .0028609          0   .0272716
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.995185           .   3.995185   3.995185
(1 real change made)
13924

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0029538           .   .0029538   .0029538

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.064532           .   2.064532   2.064532
(48,441 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13924 |     13,408    .0023143    .0025826          0   .0270783
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.476846           .   2.476846   2.476846
(1 real change made)
13925

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0029675           .   .0029675   .0029675

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    9.459911           .   9.459911   9.459911
(59,970 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13925 |      1,879    .0026812    .0033608          0   .0270646
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    11.04671           .   11.04671   11.04671
(1 real change made)
13926

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0034167           .   .0034167   .0034167

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     4.80422           .    4.80422    4.80422
(54,585 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13926 |      7,264    .0026775    .0026864   1.09e-06   .0266153
  6
Select one, randomly
(61,843 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          6    .4915304    .3406437   .0779856   .9618502

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.536171           .   6.536171   6.536171
(1 real change made)
13927

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0035986           .   .0035986   .0035986

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.398556           .   6.398556   6.398556
(57,293 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13927 |      4,556    .0028316    .0028634   2.22e-06   .0264335
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     10.8223           .    10.8223    10.8223
(1 real change made)
13928

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0036134           .   .0036134   .0036134

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     4.38187           .    4.38187    4.38187
(53,580 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13928 |      8,269    .0028206     .002739   1.36e-07   .0264187
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1      8.2625           .     8.2625     8.2625
(1 real change made)
13929

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0036699           .   .0036699   .0036699

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.906886           .   2.906886   2.906886
(49,935 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13929 |     11,914    .0026564    .0024457          0   .0263622
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2     .111505    .1360051   .0153349   .2076751

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.050456           .   3.050456   3.050456
(1 real change made)
13930

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0039388           .   .0039388   .0039388

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.095529           .   6.095529   6.095529
(56,899 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13930 |      4,950    .0029504     .002651          0   .0260933
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.149494           .   6.149494   6.149494
(1 real change made)
13931

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0045881           .   .0045881   .0045881

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.045316           .   3.045316   3.045316
(50,287 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13931 |     11,562    .0031237    .0022434   1.07e-06    .025444
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.766306           .   4.766306   4.766306
(1 real change made)
13932

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0048543           .   .0048543   .0048543

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.552479           .   5.552479   5.552479
(56,043 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13932 |      5,806    .0034047    .0022704          0   .0251778
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3855415    .1993105   .2446077   .5264754

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.600356           .   7.600356   7.600356
(1 real change made)
13933

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0048891           .   .0048891   .0048891

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.443367           .   3.443367   3.443367
(51,278 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13933 |     10,571    .0033258    .0022519   7.72e-08    .025143
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.339724           .   4.339724   4.339724
(1 real change made)
13934

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0050146           .   .0050146   .0050146

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.341708           .   4.341708   4.341708
(53,487 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13934 |      8,362    .0034535    .0023581          0   .0250175
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .4645415    .2102106   .3159002   .6131828

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.485395           .   4.485395   4.485395
(1 real change made)
13935

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0056702           .   .0056702   .0056702

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.12789           .   10.12789   10.12789
(60,250 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13935 |      1,599    .0038986    .0023024          0   .0199112
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    11.29793           .   11.29793   11.29793
(1 real change made)
13936

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0059435           .   .0059435   .0059435

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.274034           .   8.274034   8.274034
(59,259 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13936 |      2,590    .0040683    .0024178   .0000151   .0240886
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.47526           .   10.47526   10.47526
(1 real change made)
13937

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0062669           .   .0062669   .0062669

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.508946           .   7.508946   7.508946
(58,605 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13937 |      3,244    .0042713    .0024554          0   .0237652
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.583503           .   7.583503   7.583503
(1 real change made)
13938

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0068812           .   .0068812   .0068812

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.005818           .   8.005818   8.005818
(59,024 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13938 |      2,825    .0046274    .0023563          0   .0231509
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .5097198    .0619964   .4658817   .5535579

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.96036           .   10.96036   10.96036
(1 real change made)
13939

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0076829           .   .0076829   .0076829

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.989166           .   4.989166   4.989166
(54,962 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13939 |      6,887     .005314    .0022005          0   .0223492
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3721269    .4261553   .0707896   .6734643

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.013754           .   5.013754   5.013754
(1 real change made)
13940

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0083152           .   .0083152   .0083152

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.135671           .   8.135671   8.135671
(59,143 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13940 |      2,706    .0056231    .0023647   .0000123   .0217169
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    14.52327           .   14.52327   14.52327
(1 real change made)
13941

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0086983           .   .0086983   .0086983

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.604937           .   8.604937   8.604937
(59,466 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13941 |      2,383    .0059428    .0023407          0   .0213338
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    22.98564           .   22.98564   22.98564
(1 real change made)
13942

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0089062           .   .0089062   .0089062

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     8.91412           .    8.91412    8.91412
(59,675 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13942 |      2,174    .0061213    .0023418   .0000272   .0211259
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.933942           .   8.933942   8.933942
(1 real change made)
13943

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0089791           .   .0089791   .0089791

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.029713           .   6.029713   6.029713
(56,798 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13943 |      5,051    .0064214    .0023394          0    .021053
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.778559           .   6.778559   6.778559
(1 real change made)
13944

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0091903           .   .0091903   .0091903

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.411796           .   4.411796   4.411796
(53,651 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13944 |      8,198    .0063866    .0024578          0   .0208418
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.700131           .   4.700131   4.700131
(1 real change made)
13945

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0098955           .   .0098955   .0098955

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.799818           .   3.799818   3.799818
(52,153 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13945 |      9,696    .0070087    .0025308          0   .0201366
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.983982           .   3.983982   3.983982
(1 real change made)
13946

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0100905           .   .0100905   .0100905

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.411355           .   5.411355   5.411355
(55,801 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13946 |      6,048    .0074438    .0024455   .0000155   .0199416
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.087721           .   8.087721   8.087721
(1 real change made)
13947

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0104716           .   .0104716   .0104716

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.543956           .   4.543956   4.543956
(53,983 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13947 |      7,866     .007511    .0026293    .000023   .0195605
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.851888           .   4.851888   4.851888
(1 real change made)
13948

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0113406           .   .0113406   .0113406

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.863018           .   4.863018   4.863018
(54,715 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13948 |      7,134    .0083838    .0027201          0   .0186915
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .5049706    .1184176   .4212366   .5887045

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.954699           .   4.954699   4.954699
(1 real change made)
13949

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0119059           .   .0119059   .0119059

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.396048           .   4.396048   4.396048
(53,609 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13949 |      8,240    .0087283    .0028875   8.50e-06   .0181262
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.836796           .   4.836796   4.836796
(1 real change made)
13950

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .013248           .    .013248    .013248

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     14.9264           .    14.9264    14.9264
(61,263 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13950 |        586    .0101827    .0029662   .0000883   .0130491
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .2137856    .2923932   .0070324   .4205387

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    17.23019           .   17.23019   17.23019
(1 real change made)
13951

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .014101           .    .014101    .014101

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.526241           .   4.526241   4.526241
(53,951 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13951 |      7,898    .0108053    .0031705          0   .0159311
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.692992           .   4.692992   4.692992
(1 real change made)
13952

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0147532           .   .0147532   .0147532

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.310322           .   8.310322   8.310322
(59,283 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13952 |      2,566    .0110507    .0034307   .0000126   .0152789
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    11.97693           .   11.97693   11.97693
(1 real change made)
13953

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0197388           .   .0197388   .0197388

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    9.963146           .   9.963146   9.963146
(60,187 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13953 |      1,662    .0159776    .0039543          0   .0196349
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    10.15777           .   10.15777   10.15777
(1 real change made)
13954

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0225212           .   .0225212   .0225212

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.210808           .   4.210808   4.210808
(53,165 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd13954 |      8,684    .0188781    .0038879          0   .0224651
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     4.58818           .    4.58818    4.58818
(1 real change made)
. 
.                 drop _pscore _treated _support _weight _id _n1 _nn _pdif
.         }

.                 
. * Case 3 - Turning into zero income
. 
.         sort hhid pid   

.         * Using a restricted sample may overshoot the regression
.         *psmatch2 case3_treated agehead hsize educ_level if head==1 & case3_t
> reated!=., neighbor(1) noreplacement
.         
.         sum case3_treated

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
case3_trea~d |     61,849     .002878      .05357          0          1

.         if r(mean)>0 & r(mean)!=. {
.                 psmatch2 case3_treated agehead male hsize educ_level i.urban 
> i.ntiles if head==1 & case3_treated!=., neighbor(1) noreplacement

Probit regression                                       Number of obs = 14,218
                                                        LR chi2(9)    =  36.39
                                                        Prob > chi2   = 0.0000
Log likelihood = -302.89709                             Pseudo R2     = 0.0567

------------------------------------------------------------------------------
case3_trea~d | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
     agehead |  -.0025172   .0037975    -0.66   0.507    -.0099601    .0049258
        male |  -.4788885   .1159001    -4.13   0.000    -.7060486   -.2517285
       hsize |   -.078462   .0350372    -2.24   0.025    -.1471338   -.0097903
  educ_level |  -.0047197   .0324708    -0.15   0.884    -.0683613     .058922
             |
       urban |
      Urban  |  -.1282008   .1058116    -1.21   0.226    -.3355876     .079186
             |
      ntiles |
          2  |   -.163014   .1454922    -1.12   0.263    -.4481734    .1221455
          3  |  -.3220109   .1617381    -1.99   0.046    -.6390118   -.0050101
          4  |  -.2236583   .1517268    -1.47   0.140    -.5210374    .0737209
          5  |  -.4177964     .17583    -2.38   0.017     -.762417   -.0731759
             |
       _cons |  -1.620943   .2658102    -6.10   0.000    -2.141921   -1.099964
------------------------------------------------------------------------------
.                 
.                 levelsof _id if _treated==1, local(allids)      
14171 14172 14173 14174 14175 14176 14177 14178 14179 14180 14181 14182 14183 1
> 4184 14185 14186 14187 14188 14189 14190 14191 14192 14193 14194 14195 14196 
> 14197 14198 14199 14200 14201 14202 14203 14204 14205 14206 14207 14208 14209
>  14210 14211 14212 14213 14214 14215 14216 14217 14218
.                 
.                 foreach id of local allids {
  2.                         
.                         noi di "`id'"
  3.                         sum _pscore if _id==`id'
  4.                                 scalar ps`id' = r(mean)
  5.                         sum welfare_ppp17 if _id==`id'
  6.                                 scalar wf`id' = r(mean)
  7.                         
.                         gen double _psd`id' = abs(_pscore - ps`id') if _treat
> ed==0 & welfare_ppp17<wf`id'
  8.                                 sum _psd`id'
  9.                                 scalar mind`id' = r(min)
 10.                         count if _psd`id' == mind`id'
 11.                         
.                         if r(N)==0 {
 12.                                 noi di "No matching for `id'. Error"
 13.                                 error 1
 14.                         }
 15.                         if r(N)==1 {
 16.                                 sum welfare_ppp17 if _psd`id'==mind`id'
 17.                                 replace nwf = r(mean) if _id==`id'
 18.                         }
 19.                         if r(N)> 1 & r(N)!=. {
 20.                                 noi di "Select one, randomly"
 21.                                 gen _rd = runiform() if _psd`id' == mind`i
> d'
 22.                                 sum _rd
 23.                                         sum welfare_ppp17 if _rd == r(min)
>       
 24.                                         replace nwf = r(mean) if _id==`id'
 25.                                 drop _rd
 26.                         }
 27.                         
.                         drop _psd`id'
 28.                 }
14171

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0007004           .   .0007004   .0007004

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.990721           .   8.990721   8.990721
(49,844 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14171 |     12,005    .0028881    .0037626   1.47e-06   .0331145
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.449183           .   8.449183   8.449183
(1 real change made)
14172

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0013327           .   .0013327   .0013327

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.422788           .   4.422788   4.422788
(55,981 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14172 |      5,868    .0030462     .004202   5.68e-07   .0324822
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.964933           .   3.964933   3.964933
(1 real change made)
14173

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0015269           .   .0015269   .0015269

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    11.39748           .   11.39748   11.39748
(48,895 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14173 |     12,954    .0022029    .0035665   3.60e-07   .0322881
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3    .6540649    .3196544   .3325304   .9718055

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.233984           .   5.233984   5.233984
(1 real change made)
14174

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0016294           .   .0016294   .0016294

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.197036           .   5.197036   5.197036
(54,227 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14174 |      7,622     .002474    .0038839          0   .0321855
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3    .5141771    .3823018   .1891981   .9354061

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.052142           .   5.052142   5.052142
(1 real change made)
14175

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0017821           .   .0017821   .0017821

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.039417           .   7.039417   7.039417
(51,494 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14175 |     10,355    .0022425    .0037033          0   .0320329
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .6697128    .1124787   .5901784   .7492473

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.950512           .   6.950512   6.950512
(1 real change made)
14176

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0018143           .   .0018143   .0018143

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.978712           .   7.978712   7.978712
(50,583 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14176 |     11,266     .002195    .0036476   1.44e-07   .0320006
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.922012           .   7.922012   7.922012
(1 real change made)
14177

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0018666           .   .0018666   .0018666

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.391468           .   3.391468   3.391468
(58,581 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14177 |      3,268    .0033007    .0045868   3.08e-06   .0319483
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.920508           .   1.920508   1.920508
(1 real change made)
14178

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0021279           .   .0021279   .0021279

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.496056           .   7.496056   7.496056
(50,985 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14178 |     10,864    .0021173    .0035949          0   .0316871
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.475688           .   7.475688   7.475688
(1 real change made)
14179

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0023198           .   .0023198   .0023198

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.356936           .   3.356936   3.356936
(58,683 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14179 |      3,166    .0030071    .0045558   6.30e-07   .0314951
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3778991    .2022881   .2348597   .5209384

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.983291           .   1.983291   1.983291
(1 real change made)
14180

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0023299           .   .0023299   .0023299

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.170114           .   5.170114   5.170114
(54,275 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14180 |      7,574    .0022071    .0037029   8.40e-07    .031485
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.235679           .   4.235679   4.235679
(1 real change made)
14181

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0024627           .   .0024627   .0024627

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.564516           .   3.564516   3.564516
(58,133 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14181 |      3,716    .0027721    .0043952          0   .0313522
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .4715537    .0505558   .4358053    .507302

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.325179           .   3.325179   3.325179
(1 real change made)
14182

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0026954           .   .0026954   .0026954

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.902016           .   2.902016   2.902016
(59,822 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14182 |      2,027    .0029813    .0046273   2.61e-06   .0311195
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .5760262    .1019179   .5039594   .6480931

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.625404           .   2.625404   2.625404
(1 real change made)
14183

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0029876           .   .0029876   .0029876

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.118968           .   4.118968   4.118968
(56,717 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14183 |      5,132    .0023393    .0040226          0   .0308274
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.903332           .   3.903332   3.903332
(1 real change made)
14184

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .003026           .    .003026    .003026

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.858899           .   5.858899   5.858899
(53,074 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14184 |      8,775    .0021387    .0033737   4.27e-08   .0307889
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.550995           .   2.550995   2.550995
(1 real change made)
14185

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0036328           .   .0036328   .0036328

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.130268           .   6.130268   6.130268
(52,649 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14185 |      9,200    .0023043    .0031629          0   .0301821
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     5.67017           .    5.67017    5.67017
(1 real change made)
14186

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0036926           .   .0036926   .0036926

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.307231           .   3.307231   3.307231
(58,824 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14186 |      3,025    .0024988    .0043112          0   .0301223
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3    .7547035    .3297825   .3750084   .9696554

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.205984           .   3.205984   3.205984
(1 real change made)
14187

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0037043           .   .0037043   .0037043

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.135014           .   2.135014   2.135014
(61,264 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14187 |        585    .0027959     .004754          0   .0273708
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.087679           .   2.087679   2.087679
(1 real change made)
14188

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0037825           .   .0037825   .0037825

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.706591           .   5.706591   5.706591
(53,308 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14188 |      8,541      .00236     .003156   9.69e-07   .0300324
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .5680281    .2055438   .4226867   .7133696

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.265385           .   2.265385   2.265385
(1 real change made)
14189

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0038722           .   .0038722   .0038722

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.700717           .   2.700717   2.700717
(60,255 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14189 |      1,594    .0026144    .0044971   1.04e-06   .0299428
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.687327           .   2.687327   2.687327
(1 real change made)
14190

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0038843           .   .0038843   .0038843

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.901074           .   3.901074   3.901074
(57,274 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14190 |      4,575    .0023861    .0038724          0   .0299306
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .6038737    .5293689   .2295533    .978194

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.552733           .   3.552733   3.552733
(1 real change made)
14191

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0039135           .   .0039135   .0039135

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.455479           .   3.455479   3.455479
(58,419 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14191 |      3,430    .0024391    .0040948   3.66e-06   .0299015
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.243578           .   3.243578   3.243578
(1 real change made)
14192

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .004263           .    .004263    .004263

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.803821           .   5.803821   5.803821
(53,161 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14192 |      8,688    .0025806    .0030036   2.87e-06   .0295519
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .1551345    .0721184   .1041391   .2061299

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.558426           .   2.558426   2.558426
(1 real change made)
14193

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0046262           .   .0046262   .0046262

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.181038           .   2.181038   2.181038
(61,202 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14193 |        647    .0027975    .0044961          0   .0264489
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3    .6592796    .3910052   .2151566   .9517051

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     1.57911           .    1.57911    1.57911
(1 real change made)
14194

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0047378           .   .0047378   .0047378

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.304229           .   1.304229   1.304229
(61,807 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14194 |         42    .0035394    .0053885   .0000348   .0234291
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    .9380499           .   .9380499   .9380499
(1 real change made)
14195

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0048076           .   .0048076   .0048076

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.610396           .   2.610396   2.610396
(60,428 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14195 |      1,421    .0026134    .0041759          0   .0290073
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3    .3478556    .4304326   .0563158   .8422308

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.971474           .   1.971474   1.971474
(1 real change made)
14196

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0050273           .   .0050273   .0050273

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.213968           .   2.213968   2.213968
(61,158 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14196 |        691    .0028337    .0042388          0   .0260479
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.862225           .   1.862225   1.862225
(1 real change made)
14197

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0051085           .   .0051085   .0051085

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.100116           .   4.100116   4.100116
(56,764 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14197 |      5,085    .0028224    .0034089          0   .0287064
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.224738           .   3.224738   3.224738
(1 real change made)
14198

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0051261           .   .0051261   .0051261

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.464542           .   7.464542   7.464542
(51,012 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14198 |     10,837    .0031404    .0026485   6.85e-08   .0286888
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.833709           .   2.833709   2.833709
(1 real change made)
14199

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0052054           .   .0052054   .0052054

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.910213           .   1.910213   1.910213
(61,501 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14199 |        348    .0033135     .004707   .0000185   .0258697
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.862818           .   1.862818   1.862818
(1 real change made)
14200

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0055457           .   .0055457   .0055457

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.229618           .   5.229618   5.229618
(54,170 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14200 |      7,679    .0033264    .0027818   6.99e-07   .0282693
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.496401           .   2.496401   2.496401
(1 real change made)
14201

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0060588           .   .0060588   .0060588

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.013896           .   3.013896   3.013896
(59,544 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14201 |      2,305    .0030767    .0037775   1.98e-06   .0277561
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3482702    .1066841   .2728331   .4237072

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.696504           .   1.696504   1.696504
(1 real change made)
14202

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .006346           .    .006346    .006346

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.007483           .   5.007483   5.007483
(54,629 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14202 |      7,220    .0038793    .0026658   .0000112   .0274689
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.214049           .   4.214049   4.214049
(1 real change made)
14203

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0074602           .   .0074602   .0074602

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     8.70809           .    8.70809    8.70809
(50,021 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14203 |     11,828    .0049727    .0021376          0   .0263547
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.140829           .   8.140829   8.140829
(1 real change made)
14204

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0077575           .   .0077575   .0077575

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.408489           .   5.408489   5.408489
(53,831 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14204 |      8,018     .005083    .0023264   7.65e-06   .0260574
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .2471218    .3211348   .0200452   .4741984

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.647206           .   2.647206   2.647206
(1 real change made)
14205

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0080998           .   .0080998   .0080998

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.843498           .   2.843498   2.843498
(59,942 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14205 |      1,907    .0046163    .0031117   8.10e-06   .0257151
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3994307    .1112184   .3207874   .4780739

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.733065           .   1.733065   1.733065
(1 real change made)
14206

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0081642           .   .0081642   .0081642

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     1.82435           .    1.82435    1.82435
(61,578 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14206 |        271    .0051067     .003666   .0000725   .0229109
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    1.733065           .   1.733065   1.733065
(1 real change made)
14207

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0088089           .   .0088089   .0088089

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    8.070457           .   8.070457   8.070457
(50,495 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14207 |     11,354    .0060714    .0020703          0    .025006
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.828205           .   7.828205   7.828205
(1 real change made)
14208

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0088642           .   .0088642   .0088642

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.732297           .   4.732297   4.732297
(55,227 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14208 |      6,622    .0058823    .0022811   2.17e-06   .0249507
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.562254           .   4.562254   4.562254
(1 real change made)
14209

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0089776           .   .0089776   .0089776

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    15.56868           .   15.56868   15.56868
(48,203 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14209 |     13,646    .0063323    .0020904   5.87e-06   .0248373
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.828817           .   4.828817   4.828817
(1 real change made)
14210

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0100955           .   .0100955   .0100955

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1     9.78249           .    9.78249    9.78249
(49,446 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14210 |     12,403    .0072555     .002143   1.64e-06   .0237194
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    5.645969           .   5.645969   5.645969
(1 real change made)
14211

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0127043           .   .0127043   .0127043

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    6.375146           .   6.375146   6.375146
(52,340 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14211 |      9,509    .0094544     .002453   1.41e-06   .0211106
  2
Select one, randomly
(61,847 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          2    .3265506    .1766493   .2016407   .4514605

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    4.592593           .   4.592593   4.592593
(1 real change made)
14212

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0131241           .   .0131241   .0131241

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1      5.9736           .     5.9736     5.9736
(52,892 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14212 |      8,957    .0098335    .0024965   3.11e-06   .0206909
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.385034           .   3.385034   3.385034
(1 real change made)
14213

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .014193           .    .014193    .014193

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    7.361733           .   7.361733   7.361733
(51,135 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14213 |     10,714     .010834    .0027169   9.57e-07   .0196219
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.285898           .   3.285898   3.285898
(1 real change made)
14214

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0153129           .   .0153129   .0153129

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.376507           .   3.376507   3.376507
(58,627 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14214 |      3,222     .010955    .0026228   .0000174   .0185021
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.947494           .   2.947494   2.947494
(1 real change made)
14215

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0166813           .   .0166813   .0166813

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.008713           .   3.008713   3.008713
(59,556 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14215 |      2,293    .0119391    .0027566   3.76e-06   .0171337
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.707031           .   2.707031   2.707031
(1 real change made)
14216

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0233446           .   .0233446   .0233446

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.973255           .   2.973255   2.973255
(59,638 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14216 |      2,211    .0181341    .0040909   .0000174   .0232489
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.708725           .   2.708725   2.708725
(1 real change made)
14217

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1    .0248536           .   .0248536   .0248536

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    3.876439           .   3.876439   3.876439
(57,327 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14217 |      4,522    .0202465    .0041192   .0000431   .0247897
  3
Select one, randomly
(61,846 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         _rd |          3      .30352     .325275   .0595561   .6728176

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.421997           .   2.421997   2.421997
(1 real change made)
14218

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _pscore |          1     .027364           .    .027364    .027364

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.917619           .   2.917619   2.917619
(59,785 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _psd14218 |      2,064    .0220235    .0045785    .000159   .0272683
  1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
welfare_p~17 |          1    2.224633           .   2.224633   2.224633
(1 real change made)
. 
.                 drop _pscore  _support _weight _id _n1 _nn _pdif
.         }

.         
.         bys hhid: egen pc_con_s = mean(nwf)
(9 missing values generated)

.         
.         
.         * Re-scale according to growth in private consumption per capita
.         sum welfare_ppp17 [w=wgt]
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
welfare_p~17 |  61,849   165687181    5.979807   4.656535   .7735212   101.2955

.                 scalar pcconsbase = r(mean)

.                 
.         sum pc_con_s [w=wgt]
(analytic weights assumed)

    Variable |     Obs      Weight        Mean   Std. dev.       Min        Max
-------------+-----------------------------------------------------------------
    pc_con_s |  61,840   165662131    4.845699    4.22858    .013385   87.23955

.                 scalar pccons_int = r(mean)

.         
.         scalar objective_pccons = pccons[1,1]+1

.         
.         rename pc_con_s pc_con_preadj

.         
.         gen double pc_con_s = pc_con_preadj * (objective_pccons * pcconsbase)
>  / (pccons_int)
(9 missing values generated)

.         label var pc_con_s "Final Per Capita Household Consumption"

.         
.         
. *============================================================================
> =
. *                                     END
. *============================================================================
> =
. 
.         
.         
. 
end of do-file
(analytic weights assumed)
 
Percentile ratios

----------------------------------------------------------
  All obs |    p90/p10     p90/p50     p10/p50     p75/p25
----------+-----------------------------------------------
          |      4.054       2.146       0.529       2.062
----------------------------------------------------------
  
Generalized Entropy index GE(2), and Gini coefficient

----------------------------------
  All obs |      GE(2)        Gini
----------+-----------------------
          |    0.30319     0.33373
----------------------------------
(analytic weights assumed)
 
Percentile ratios

----------------------------------------------------------
  All obs |    p90/p10     p90/p50     p10/p50     p75/p25
----------+-----------------------------------------------
          |      4.658       2.326       0.499       2.174
----------------------------------------------------------
  
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
          |    0.31104     0.22170     0.24666     0.38075     0.36287
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e > 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.10951     0.19884     0.38351
----------------------------------------------
(analytic weights assumed)


 The poverty line is set at 2.15 units



-------------------------------------------------
Poverty measures of welfare_ppp17 | welfare_ppp17
----------------------------------+--------------
                Headcount ratio % |         5.008
Extreme Poverty Headcount ratio % |         0.144
-------------------------------------------------

[aweight= wgt]
(analytic weights assumed)


 The poverty line is set at 2.15 units



----------------------------------------------------------------
Poverty measures of pc_con_s      |
pc_con_preadj                     |      pc_con_s  pc_con_preadj
----------------------------------+-----------------------------
                Headcount ratio % |         6.256         15.400
Extreme Poverty Headcount ratio % |         0.714          1.586
----------------------------------------------------------------

[aweight= fexp_s]
(7 observations deleted)
file C:/Users/WB308767/OneDrive/WBG/ETIRI/Projects/FY25/FY25 - SAR MPO
    AM24/BGD-MPO-Microsimulation/2024AM/Data/OUTPUT/basesim_2025.dta saved
. }

. *===========================================================================
. * Display running time  
. etime
Elapsed time is 53 seconds 

. *===========================================================================
. *                                     END
. *===========================================================================
. 
end of do-file
